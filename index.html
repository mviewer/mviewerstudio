<!DOCTYPE html>
<html lang="fr" class="h-100">
<head>
    <title>Mviewer Studio</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Mviewer Teams">
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="img/favicon_mstudio.png" />
    <!-- Custom stylesheet bootstrap and mstudio for this app-->
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/mviewerstudio.css" type="text/css">
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@2.2.0/fonts/remixicon.css">
    <link rel="stylesheet" href="lib/openlayers/7.1/ol.css" type="text/css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.13.0/css/all.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="lib/Sortable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/4.6.3/papaparse.min.js"></script>
    <script src="lib/bootstrap/5.2/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-tagsinput/0.8.0/bootstrap-tagsinput.min.js"></script>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-tagsinput/0.8.0/bootstrap-tagsinput.css"/>    
    <link rel="stylesheet" href="lib/icon-picker/icon-picker.css" type="text/css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.4.4/proj4.js"></script>
    <script type="text/javascript" src="lib/openlayers/7.1/ol.js"></script>
    <script src="lib/ogc.js"></script>
    <script src="lib/mv.js"></script>
    <script src="lib/slug.js"></script>
    <script src="lib/i18njs/i18n.min.js" type="text/javascript"></script>
    <!--Wizard-->
    <link rel="stylesheet" href="css/wizard.css">    
    <!--Bootstrap table extension-->
    <link rel="stylesheet" href="lib/bootstrap-table/bootstrap-table.min.css">
    <link rel="stylesheet" href="lib/template-generator/style.css">
</head>

<body class="h-100" id="content">
    <!--NAVBAR-->
    <nav class="navbar bg-primary fixed-top" id="navbarStudio">
        <div class="container-fluid">
        <a class="navbar-brand">
            <img src="img/logo_mviewerstudio.svg" alt="Logo" width="125" class="d-inline-block mx-right-4">             
            <span class="mx-3"><span id="studio-title" class="navbar-brand"></span></span>            
        </a>
        <div class="d-flex align-items-center" id="navBarStudioMenu">
            <div class="nav-item">
                <span class="navbar-text px-2 d-none" id="user_connected"><span i18n="banner.not_connected">Non connecté</span></span>         
            </div>               
            <div class="px-4 nav-item d-none" id="menu_user_logout">
                <a role="button" href="/logout"><span i18n="banner.logout">Déconnexion</span></a>
            </div>
            <a class="zoom" onclick="goHome();"><i class="ri-home-6-line" title="Retour vers l'accueil" style="font-size: 30px;"></i></a>
        </div>
        </div>
    </nav>
    <!--/NAVBAR-->
    <main class="h-100">
        <!--HOME-->
        <div class="container-fluid h-100" id="containerHome">
            <div class="row justify-content-around align-items-center h-100">
                <div class="col-md-4">
                    <img src="img/homeMstudio.svg" alt="Logo" width="80%" class="d-inline-block mx-right-4">
                    <div class="">
                        <span class="subtitle-home">MVIEWER STUDIO</span><br>
                        <span class="title-home" i18n="home.welcome_title">Bienvenue</span>                        
                    </div>
                    <h4 class="text-primary" i18n="home.welcome_texte">Créer votre application cartographique mviewer en suivant les étapes du générateur</h4>               
                </div>
                <div class="col-md-6">
                    <h3 class="text-primary m-2 mb-4"><strong><span i18n="home.welcome_question">Que voulez-vous faire ?</span></strong> </h3>
                    <div id="cardsHome">
                        <!--Open config-->
                        <a data-bs-toggle="modal" data-bs-target="#mod-importfile" href="#">
                            <div class="card text-white bg-warning p-3 m-2 zoomCard h-100 noborder" style="max-width: 18rem;">
                                <div class="card-body mb-5">
                                <span class="iconCard-home">
                                    <i class="bi bi-upload" style="font-size: 20px;vertical-align: revert;"></i>
                                </span>                            
                                <h5 class="card-title mt-4"><span i18n="home.open_title">Ouvrir un projet existant</span></h5>
                                <p class="card-text"><span i18n="home.open_texte">Importer un fichier de configuration .XML depuis votre ordinateur ou un serveur</span></p>                              
                                </div>
                            </div>
                        </a> 
                        <!--Open config-->
                        <!--New config-->
                        <a onclick="newConfiguration(); showStudio()">
                            <div class="card text-white bg-info p-3 m-2 zoomCard h-100 noborder" style="max-width: 18rem;">
                                <div class="card-body mb-5">
                                <span class="iconCard-home">
                                    <i class="bi bi-file-earmark-plus" style="font-size: 20px;vertical-align: revert;"></i>
                                </span>                            
                                <h5 class="card-title mt-4"><span i18n="home.newproject_title">Créer un nouveau projet</span></h5>
                                <p class="card-text"><span i18n="home.newproject_texte">Débuter la configuration d'une nouvelle application mviewer</span></p>                              
                                </div>
                            </div>
                        </a>
                    </div>                    
                </div>
                <nav class="navbar fixed-bottom" id="homeNavbarDoc">
                    <div class="container-fluid justify-content-end">
                        <a class="nav-item m-3" href="https://github.com/mviewer/mviewerstudio" target="_blank" i18n="home.navlink_github">Github</a>
                        <a class="nav-item m-3" href="https://mviewerstudio.readthedocs.io/fr/stable/" target="_blank" i18n="home.navlink_doc">Documentation</a>
                        <a class="nav-item m-3" data-bs-toggle="modal" data-bs-target="#modalCredits" i18n="home.navlink_credits">Crédits</a>
                    </div>
                </nav>
            </div>
        </div>    
        <!--/HOME-->   
        <!-- MODULES STUDIO-->   
        <div class="container-fluid h-100" id="containerStudio" hidden>
            <div class="row justify-content-around" style="padding-top: 120px;">
                <!-- WIZARD BLOC -->
                <div class="col-xl-3 col-md-12" id="blockWizard">
                    <div class="bg-light">
                        <div class="mb-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <h3 class="text-primary strong" id="nameAppBlock">Mon application</h3>
                                <span class="badge badge-publish badge-title d-none" i18n="publish">En ligne</span>
                                <span class="badge badge-draft badge-title d-none" i18n="draft">Brouillon</span>
                            </div>                            
                            <span class="text-primary" id="detailArea">MVIEWER</span>
                        </div> 
                        <!-- STEP STUDIO -->
                        <ul class="nav nav-pills flex-column mb-5" id="stepStudio">
                            <li class="nav-item" id="navWizApp">
                                <a class="nav-link active" data-bs-toggle="tab" href="#app" id="appWizzardTab">
                                    <i class="ri-equalizer-line"></i>
                                    <div>
                                        <p class="title-wizard" i18n="studio.wizard.app_title">Application </p>
                                        <p class="subtitle-wizard" i18n="studio.wizard.app_text">Paramètres globaux de l'application</p>
                                    </div>                                
                                </a>
                            </li>
                            <li class="nav-item" id="navWizData">
                                <a class="nav-link" data-bs-toggle="tab" href="#themesdata" onclick="mv.saveIfNecessary()">
                                    <i class="ri-stack-line"></i>
                                    <div>
                                        <p class="title-wizard" i18n="studio.wizard.theme_title">Thématiques & données</p>
                                        <p class="subtitle-wizard" i18n="studio.wizard.theme_text">Paramètres des thématiques et des données</p>
                                    </div> 
                                </a>
                            </li>
                            <li class="nav-item advanced" id="navWizFadv" style="display: none">
                                <a class="nav-link" data-bs-toggle="tab" href="#fadanced" onclick="mv.saveIfNecessary()">
                                    <i class="ri-list-settings-line"></i>
                                    <div>
                                        <p class="title-wizard" i18n="studio.wizard.advanced_title">Fonctionnalités avancées</p>
                                        <p class="subtitle-wizard" i18n="studio.wizard.advanced_text">Paramètres des fonctionnalités supplémentaires</p>
                                    </div>
                                </a>
                            </li>                         
                            <li class="nav-item" id="navWizPub">
                                <a class="nav-link" data-bs-toggle="tab" href="#publication" onclick="mv.saveIfNecessary()">                                
                                    <i class="ri-download-line"></i>
                                    <div>
                                        <p class="title-wizard" i18n="studio.wizard.publication_title">Publication</p>
                                        <p class="subtitle-wizard" i18n="studio.wizard.publication_text">Finaliser votre application</p>
                                    </div>                                    
                                </a>
                            </li>
                        </ul>
                        <!-- ./STEP STUDIO -->       
                        <div class="text-info mt-4" id="helpStudioBloc">
                            <img src="img/doc.png" alt="Img doc" width="80px" style="margin-right: 2em;">
                            <div class="helpStudio-text my-2">
                                <h4 class="strong m-0" i18n="studio.wizard.help_title">Besoin d'aide ?</h4>
                                <p i18n="studio.wizard.help_text">Consulter la documentation</p>
                                <a class="btn btn-outline-info" href="https://mviewerstudio.readthedocs.io/fr/stable/" target="_blank" i18n="consult">Voir</a>
                            </div>                        
                        </div>
                    </div>
                    <ul class="nav" id="wizardCredits">
                        <a class="nav-link m-1" href="https://github.com/mviewer/mviewerstudio" target="_blank" i18n="home.navlink_github">Github</a>                          
                        <a class="nav-link m-1" data-bs-toggle="modal" data-bs-target="#modalCredits" i18n="home.navlink_credits">Crédits</a>
                    </ul>                       
                </div>
                <!-- /WIZARD BLOC -->
                <!-- WIZARD BLOC MOBILE -->
                <nav class="navbar fixed-bottom bg-light justify-content-center" id="blockWizardMobile" hidden>
                    <ul class="nav bg-light justify-content-center">
                        <li class="nav-item">
                                <a class="nav-link active" data-bs-toggle="tab" href="#app">
                                    <i class="ri-equalizer-line"></i>                               
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-bs-toggle="tab" href="#themesdata">
                                    <i class="ri-stack-line"></i> 
                                </a>
                            </li>
                            <li class="nav-item advanced" style="display: none">
                                <a class="nav-link" data-bs-toggle="tab" href="#fadanced">                                
                                    <i class="ri-list-settings-line"></i>
                                </a>
                            </li>                            
                            <li class="nav-item">
                                <a class="nav-link" data-bs-toggle="tab" href="#publication">                                
                                    <i class="ri-download-line"></i>                                
                                </a>
                            </li>
                    </ul>
                </nav>                
                <!-- /WIZARD BLOC MOBILE -->
                <!-- CONTAINER STUDIO -->
                <div class="col-xl-8 col-md-12">
                    <!--TOOLSBAR -->
                    <div id="toolsbarStudio">                        
                        <ul class="nav align-items-center justify-content-end"> 
                            <div class="btn-group d-none advanced" id="layerOptionBtn">
                                <button type="button" class="nav-link btn btn-outline-info dropdown-toggle" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                  Options
                                </button>
                                <div class="dropdown-menu">
                                  <a class="dropdown-item" onclick="mv.getVersionsByApp(this)" data-bs-toggle="modal" data-bs-target="#mod-appversions" i18n="release.btn.tooltip">Historique des modifications</a>
                                </div>
                            </div>                                
                            <a class="nav-link d-none" id="toolsbarStudio-unpublish" onclick="mv.unpublish(config.id);" href="#"><i class="ri-eye-off-fill"></i> <span i18n="studio.toolsbar.unpublish">Dépublier</span></a>               
                            <a class="nav-link d-none" id="toolsbarStudio-delete" onclick="showAlertDelApp(config.id);" href="#"><i class="ri-delete-bin-2-line"></i> <span i18n="studio.toolsbar.delete">Supprimer</span></a>                
                            <a class="nav-link" id="toolsbarStudio-View" onclick="previewAppsWithoutSave(config.id);" href="#"><i class="ri-eye-2-line"></i> <span i18n="studio.toolsbar.preview">Prévisualiser</span></a>                          
                            <a class="nav-link" id="toolsbarStudio-Save" onclick="saveStudio();" href="#"><i class="ri-save-line"></i> <span i18n="studio.toolsbar.save">Enregistrer</span></a>
                        </ul>
                        <div class="custom-control custom-switch mt-2" id="btnSwitchAdvanced">
                            <input type="checkbox" class="custom-control-input" id="SwitchAdvanced">
                            <label class="custom-control-label" for="SwitchAdvanced"><span i18n="studio.toolsbar.advanced" checked="true">Mode avancé</span></label>
                        </div>
                    </div>                    
                    <!--/.TOOLSBAR -->
                    <!-- STUDIO TABS -->
                    <div class="tab-content my-4" id="stepStudioContent">
                        <!-- Application -->
                        <div class="tab-pane container active" id="app">
                            <form>
                            <h1>
                                <i class="ri-equalizer-line"></i> 
                                <span i18n="tabs.app.title">Application</span>                                 
                            </h1>         
                            <div class="row mt-4">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label for="opt-title" i18n="head.title" class="form-label">Titre de l'application</label>
                                        <input class="form-control" id="opt-title" type="text" name="textinput" placeholder="Mon application">
                                    </div>
                                </div>
                                <div class="col-md-6 advanced">
                                    <div class="form-group">
                                        <label for="optKeywords" i18n="head.keywords" class="form-label">Mots clés</label>
                                        <input class="form-control" onchange="mv.changeKeyWords(this)" id="optKeywords" type="text" name="textinput" placeholder="ex: carte,rennes,lycées">
                                    </div>
                                </div>
                                <div class="col-md-6 advanced">
                                    <div class="form-group">
                                        <label for="optProxyUrl" i18n="head.proxyurl" class="form-label">URL du proxy</label>
                                        <input class="form-control" id="optProxyUrl" type="text" name="textinput" placeholder="https://proxy.fr">
                                    </div>
                                </div>
                            </div>  
                            <div class="row">
                                <div class="col-md-6 advanced" style="display: none;">
                                    <div class="form-group">
                                        <label for="opt-favicon" class="form-label"><span i18n="tabs.app.favicon">Lien vers le favicon </span><span class="tooltip-info" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="tooltip.app.logo"><i class="ri-information-line"></i></span></label>
                                        <input class="form-control checkedurl" id="opt-favicon" placeholder="https://monfavicon.png">
                                    </div>
                                </div>         
                                <div class="col-md-6 advanced" style="display: none;">
                                    <div class="form-group">
                                        <label for="opt-home" class="form-label"><span i18n="tabs.app.home">Lien vers site parent </span><span class="tooltip-info" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="tooltip.redirect.logo"><i class="ri-information-line"></i></span></label>
                                        <input class="form-control checkedurl" id="opt-home" placeholder="https://mapage.fr">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="opt-logo" class="form-label"><span i18n="tabs.app.url">Lien vers le logo </span><span class="tooltip-info" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="tooltip.logo"><i class="ri-information-line"></i></span></label>
                                        <input class="form-control checkedurl" id="opt-logo" placeholder="https://monlogo.png">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label" for="frm-style" ><span i18n="tabs.app.style">Thème de l'application</span><span class="tooltip-info" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="tooltip.color.ihm"><i class="ri-information-line"></i></span></label>
                                        <select class="form-control default" id="opt-style" name="style" onchange="updateTheme(this);">
                                            <option class="alizarin" value="css/themes/alizarin.css">alizarin</option>
                                            <option class="amethyst" value="css/themes/amethyst.css">amethyst</option>
                                            <option class="black" value="css/themes/black.css">black</option>
                                            <option class="blue" value="css/themes/blue.css">blue</option>
                                            <option class="carrot" value="css/themes/carrot.css">carrot</option>
                                            <option class="chambray" value="css/themes/chambray.css">chambray</option>
                                            <option class="default" selected value="css/themes/default.css">default</option>
                                            <option class="theme-designfr" selected value="css/themes/theme-designfr/theme_designfr.css">design_etat</option>
                                            <option class="green" value="css/themes/green.css">green</option>
                                            <option class="green_sea" value="css/themes/green_sea.css">green_sea</option>
                                            <option class="nephritis" value="css/themes/nephritis.css">nephritis</option>
                                            <option class="peter_river" value="css/themes/peter_river.css">peter_river</option>
                                            <option class="pink" value="css/themes/pink.css">pink</option>
                                            <option class="ripe_lemon" value="css/themes/ripe_lemon.css">ripe_lemon</option>
                                            <option class="wet_asphalt" value="css/themes/wet_asphalt.css">wet_asphalt</option>
                                        </select>
                                    </div>
                                </div>                                
                            </div>                  
                            <!--Fonctionnalités et options de la carte-->                          
                            <div class="row mt-4">
                                <div class="col-md-6">    
                                    <ul class="list-group">
                                        <li class="list-group-item">
                                            <span class="title-accordion" i18n="tabs.app.options_title">Fonctionnalités</span><br>
                                            <span class="subtitle-accordion" i18n="tabs.app.options_text">Activer les outils que vous souhaitez afficher au sein de votre application</span>
                                        </li>
                                        <li class="list-group-item">
                                            <div class="list-flex">
                                                <span i18n="tabs.app.opt_zoom">Outils de zoom</span>
                                                <div class="custom-control custom-switch">
                                                    <input type="checkbox" class="custom-control-input" checked="true" name="checkboxes" id="opt-zoomtools">
                                                    <label class="custom-control-label" for="opt-zoomtools"></label>
                                                </div>
                                            </div>                                            
                                        </li>
                                        <li class="list-group-item">
                                            <div class="list-flex">
                                                <span i18n="tabs.app.opt_measure">Outils de mesures</span>
                                                <div class="custom-control custom-switch">
                                                    <input type="checkbox" class="custom-control-input" name="checkboxes" id="opt-measuretools">
                                                    <label class="custom-control-label" for="opt-measuretools"></label>
                                                </div>
                                            </div>                                            
                                        </li>
                                        <li class="list-group-item">
                                            <div class="list-flex">
                                                <span i18n="tabs.app.opt_export">Export de la carte en image</span>
                                                <div class="custom-control custom-switch">
                                                    <input type="checkbox" class="custom-control-input" name="checkboxes" id="opt-exportpng">
                                                    <label class="custom-control-label" for="opt-exportpng"></label>
                                                </div>
                                            </div>                                            
                                        </li>
                                        <li class="list-group-item">
                                            <div class="list-flex">
                                                <span i18n="tabs.app.opt_geoloc">Se géolocaliser</span>                                          
                                                <div class="custom-control custom-switch">
                                                    <input type="checkbox" class="custom-control-input" name="checkboxes" id="opt-geoloc">
                                                    <label class="custom-control-label" for="opt-geoloc"></label>
                                                </div>
                                            </div>
                                        </li>
                                        <li class="list-group-item advanced" style="display: none;">
                                            <div class="list-flex">
                                                <span i18n="tabs.app.opt_coords">Affichage des coordonnées au clic</span>
                                                <div class="custom-control custom-switch">
                                                    <input type="checkbox" class="custom-control-input" name="checkboxes" id="opt-coordinates">
                                                    <label class="custom-control-label" for="opt-coordinates"></label>
                                                </div>
                                            </div>                                            
                                        </li>
                                        <li class="list-group-item advanced" style="display: none;">
                                            <div class="list-flex">
                                                <span i18n="tabs.app.opt_mouseposition">Afficher les coordonnées correspondant à la position de la souris</span>
                                                <div class="custom-control custom-switch">
                                                    <input type="checkbox" class="custom-control-input" name="checkboxes" id="opt-mouseposition">
                                                    <label class="custom-control-label" for="opt-mouseposition"></label>
                                                </div>
                                            </div>                                            
                                        </li>
                                        <li class="list-group-item advanced" style="display: none;">
                                            <div class="list-flex">
                                                <span i18n="tabs.app.opt_data">Afficher/masquer toutes les données d'une thématique en un clic</span>                                          
                                                <div class="custom-control custom-switch">
                                                    <input type="checkbox" class="custom-control-input" name="checkboxes" id="opt-togglealllayersfromtheme">
                                                    <label class="custom-control-label" for="opt-togglealllayersfromtheme"></label>
                                                </div>
                                            </div>                                            
                                        </li>

                                        <li class="list-group-item advanced" style="display: none;">
                                            <div class="list-flex">
                                                <span i18n="tabs.app.opt_studio">Ouvrir la carte dans le studio</span>                                          
                                                <div class="custom-control custom-switch">
                                                    <input type="checkbox" class="custom-control-input" name="checkboxes" id="opt-studio">
                                                    <label class="custom-control-label" for="opt-studio"></label>
                                                </div>
                                            </div>                                            
                                        </li>
                                      </ul>
                                </div>
                                <div class="col-md-6">
                                    <ul class="list-group">
                                        <li class="list-group-item">
                                            <span class="title-accordion" i18n="tabs.app.map_title">Options de la carte</span><br>
                                            <span class="subtitle-accordion" i18n="tabs.app.map_text">Paramètrer l'étendue et le zoom de la carte au démarrage de l'application</span>
                                        </li>
                                        <li class="list-group-item p-0">
                                             <!-- Map -->
                                            <div id="map" class="map"></div>
                                        </li>
                                        <li class="list-group-item">
                                            <div class="list-flex">
                                                <span><span i18n="tabs.app.opt_initialextent">Revenir à l'étendue initiale</span><span class="tooltip-info" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="tooltip.initial.extent"><i class="ri-information-line"></i></span></span>                                           
                                                <div class="custom-control custom-switch">
                                                    <input type="checkbox" class="custom-control-input" name="checkboxes" id="opt-initialextenttool">
                                                    <label class="custom-control-label" for="opt-initialextenttool"></label>
                                                </div>
                                            </div>                                            
                                        </li>
                                        <li class="list-group-item advanced" style="display: none;">
                                            <div class="list-flex">
                                                <span i18n="tabs.app.opt_maxextent">Interdire la navigation hors de l'étendue définie ci-dessus</span>                                           
                                                <div class="custom-control custom-switch">
                                                    <input type="checkbox" class="custom-control-input" name="checkboxes" id="opt-maxextent">
                                                    <label class="custom-control-label" for="opt-maxextent"></label>
                                                </div>
                                            </div>                                            
                                        </li>
                                      </ul>
                                </div>
                            </div>  
                            <!--./Fonctionnalités et options de la carte-->                          

                            <!--Fond de plan-->
                            <div class="accordion mt-4" id="backgroundlayers-config">
                                <div class="accordion-item">
                                  <h2 class="accordion-header" >
                                    <a class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFondPlan" aria-expanded="true" aria-controls="collapseFondPlan">
                                      <div>
                                        <span class="title-accordion" i18n="tabs.app.bg_title">Fonds de plan</span><br>
                                        <span class="subtitle-accordion" i18n="tabs.app.bg_text">Sélectionner les fonds de plan à afficher et le mode d'affichage</span>
                                      </div>
                                    </a>
                                  </h2>
                                  <div id="collapseFondPlan" class="accordion-collapse collapse" aria-labelledby="accordionFondPlan">
                                    <div class="accordion-body p-0"> 
                                        <ul class="list-group list-group-flush">
                                            <div id="frm-bl"></div>
                                            <li class="list-group-item" >
                                                <div class="row mb-2" >                                                    
                                                    <div class="col-md-6 advanced" style="display: none;">
                                                        <label for="frm-bl-mode" class="form-label" i18n="tabs.app.bg.displaymode" >Mode d'affichage</label>
                                                        <select id="frm-bl-mode" name="bl-mode" class="form-control">
                                                            <option value="default"  i18n="tabs.app.bg.display_normal">Normal</option>
                                                            <option value="gallery" i18n="tabs.app.bg.display_gallery">Gallerie</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label for="frm-bl-mode" class="form-label" i18n="tabs.app.bg.startup_bg">Fond de plan au démarrage</label>
                                                        <select id="frm-bl-visible" name="bl-visible" class="form-control" onchange="mv.changeVisibleBaseLayer(this.value)"></select>
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="list-group-item advanced" style="display: none;">
                                                <div class="list-flex">
                                                    <p class="strong" i18n="tabs.app.bgcustom.title">Ajouter un fond de plan personnalisé</p>
                                                    <div class="custom-control custom-switch">
                                                        <input onchange="mv.changeBaseMapType(this)" type="checkbox" class="custom-control-input" id="SwitchCustomBackground">
                                                        <label class="custom-control-label" for="SwitchCustomBackground"></label>
                                                    </div>
                                                </div>
                                                <div id="appCustomBackgroundBlock" class="d-none">                                                 
                                                    <div class="row mb-2" >                                                    
                                                        <div class="col-md-12">
                                                            <label for="frm-custombg-type" i18n="tabs.app.bgcustom.type" class="form-label">Type</label>
                                                            <select class="form-control b" id="frmBlCustomType" name="Type of layer" onchange="mv.selectBaseMapTypeValue(this)">
                                                                <option value="" selected i18n="tabs.app.bgcustom.type_empty">Choisir un type...</option>
                                                                <!-- <option value="osm" i18n="tabs.app.bgcustom.type_OSM">OSM</option> -->
                                                                <option value="wmts" i18n="tabs.app.bgcustom.type_WMTS">WMTS</option>
                                                                <option value="wms" i18n="tabs.app.bgcustom.type_WMS">WMS</option>
                                                                <option value="vector-tms" i18n="tabs.app.bgcustom.type_TMS">Vector-TMS</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div id="customBgCommons" class="row mt-2 custom-bg-commons" >
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <label for="formCustomBaseId" class="form-label"><span i18n="tabs.app.bgcustom.base.id">Identifiant</span><span class="tooltip-info" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="tooltip.intern.id"><i class="ri-information-line"></i></span></label>
                                                                <input class="form-control" id="formCustomBaseId" placeholder="positron" i18n="tabs.app.bgcustom.base.id.ph" required>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <label for="formCustomBaseLabel" class="form-label"><span i18n="tabs.app.bgcustom.base.label">Libellé</span><span class="tooltip-info" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="tooltip.base.name""><i class="ri-information-line"></i></span></label>
                                                                <input class="form-control" id="formCustomBaseLabel" placeholder="Positron" i18n="tabs.app.bgcustom.base.label.ph" required>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <label for="formCustomBaseUrl" class="form-label"><span i18n="tabs.app.bgcustom.base.url">URL</span><span class="tooltip-info" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="tooltip.webservice.url"><i class="ri-information-line"></i></span></label>
                                                                <input class="form-control checkedurl" type="url" id="formCustomBaseUrl" i18n="tabs.app.bgcustom.base.url.ph" placeholder="http://{a-c}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png" required>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <label for="formCustomBaseNameLayers" class="form-label"><span i18n="tabs.app.bgcustom.base.nameLayers">Couches</span><span class="tooltip-info" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="tooltip.tec.id.layer"><i class="ri-information-line"></i></span></label>
                                                                <input class="form-control" id="formCustomBaseNameLayers" i18n="tabs.app.bgcustom.base.nameLayers.ph" placeholder="satellite" required>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <label for="formCustomBaseAttribution" class="form-label"><span i18n="tabs.app.bgcustom.base.attribution">Attribution</span><span class="tooltip-info" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="tooltip.src.credit"><i class="ri-information-line"></i></span></label>
                                                                <input class="form-control" id="formCustomBaseAttribution" i18n="tabs.app.bgcustom.base.attribution.ph" placeholder="Map tiles by carto.com - Licence cc 3.0">
                                                            </div>
                                                        </div>   
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <label for="formCustomBaseTitle" class="form-label"><span i18n="tabs.app.bgcustom.base.title">Sous-titre</span><span class="tooltip-info" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="tooltip.infos"><i class="ri-information-line"></i></span></label>
                                                                <input class="form-control" id="formCustomBaseTitle" placeholder="positron" i18n="tabs.app.bgcustom.base.title.ph">
                                                            </div>
                                                        </div>   
                                                    </div>
                                                    <div class="row mt-2" >                                                        
                                                        <div class="col-md-6 wmts wms vector-tms custom-bg-type">
                                                            <div class="form-group">
                                                                <label for="formCustomBaseThumb" class="form-label"><span i18n="tabs.app.bgcustom.base.thumb">Lien vers la vignette</span><span class="tooltip-info" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="tooltip.img.preview.base"><i class="ri-information-line"></i></span></label>
                                                                <input class="form-control checkedurl" type="url" id="formCustomBaseThumb" i18n="tabs.app.bgcustom.base.thumb.ph" placeholder="https://kartenn.region-bretagne.fr/kartoviz/img/basemap/positron.png" required>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6 wmts wms custom-bg-type">
                                                            <label for="formCustomBaseFormat"  class="form-label"><span i18n="tabs.app.bgcustom.base.format">Format</span><span class="tooltip-info" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="tooltip.img.from.server"><i class="ri-information-line"></i></span></label>
                                                            <select class="form-control" id="formCustomBaseFormat" name="formCustomBaseFormat">
                                                                <option value="image/png">image/png</option>
                                                                <option value="image/jpeg">image/jpeg</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-md-6 vector-tms custom-bg-type">
                                                            <div class="form-group">
                                                                <label for="formCustomBaseStyleUrl" class="form-label"><span i18n="tabs.app.bgcustom.base.styleUrl">Lien vers le fichier de style</span><span class="tooltip-info" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="tooltip.json.file.base.style"><i class="ri-information-line"></i></span></label>
                                                                <input class="form-control checkedurl" type="url" id="formCustomBaseStyleUrl" i18n="tabs.app.bgcustom.base.styleUrl.ph" placeholder="https://wxs.ign.fr/static/vectorTiles/styles/ADMIN_EXPRESS/adminexpress.json" required>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6 wmts vector-tms custom-bg-type">
                                                            <div class="form-group">
                                                                <label for="formCustomBaseStyle" class="form-label"><span i18n="tabs.app.bgcustom.base.style">Style</span><span class="tooltip-info" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="tooltip.style.tms.name"><i class="ri-information-line"></i></span></label>
                                                                <input class="form-control" id="formCustomBaseStyle" placeholder="bdtopo" required>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6 wmts custom-bg-type">
                                                            <div class="form-group">
                                                                <label for="formCustomBaseMatrixset" class="form-label"><span i18n="tabs.app.bgcustom.base.matrixset">Matrixset</span><span class="tooltip-info" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="tooltip.pyramid.img.name"><i class="ri-information-line"></i></span></label>
                                                                <input class="form-control" id="formCustomBaseMatrixset" placeholder="PM">
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div id="BasemapAlertPlaceholder"></div>
                                                    <button type="button" id="addCustomBl" onclick="mv.validateFormBaseLayer(this)" class="btn btn-info d-none" ><i class="bi bi-plus-lg"></i><span i18n="add"> Ajouter</span></button>
                                                </div>
                                            </li>
                                          </ul>
                                    </div>
                                  </div>
                                </div>
                            </div>
                            <!--./Fond de plan-->

                            <!--Page d'accueil-->
                            <div class="accordion mt-4 advanced" style="display: none;">
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="accordionHomePage">
                                        <a class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHomePage" aria-expanded="true" aria-controls="collapseHomePage">
                                        <div>
                                            <span class="title-accordion" i18n="tabs.app.home_title">Page d'accueil </span><br>
                                            <span class="subtitle-accordion" i18n="tabs.app.home_text">Paramétrer la page d'accueil / documentation</span>
                                        </div>
                                        </a>
                                    </h2>
                                    <div id="collapseHomePage" class="accordion-collapse collapse" aria-labelledby="accordionHomePage">
                                        <div class="accordion-body"> 
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label for="opt-titlehelp" class="form-label"><span i18n="tabs.app.help_title">Titre de la fenêtre d'aide / accueil</span></label>
                                                        <input class="form-control" id="opt-titlehelp" placeholder="Accueil">
                                                    </div>
                                                </div>   
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label for="opt-iconhelp" class="form-label"><span i18n="tabs.app.help_icon">Icône du bouton</span></label>                                                        
                                                        <div class="d-flex">
                                                            <input type="text" class="icon-class-input form-control" placeholder="fas fa-home" id="opt-iconhelp">
                                                            <span class="selected-icon"></span>
                                                            <button class="btn btn-outline-info picker-button" type="button" data-bs-target="#iconPicker" data-bs-toggle="modal">
                                                                <span i18n="select">Sélectionner</span>
                                                            </button>                                                           
                                                        </div>
                                                    </div>
                                                </div>      
                                            </div>    
                                            <div class="form-group">
                                                <label for="opt-help" i18n="tabs.app.help_link" class="form-label">Lien vers la page d'accueil</label><span class="tooltip-info" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="tooltip.home.url"><i class="ri-information-line"></i></span>
                                                <input class="form-control checkedurl" id="opt-help" name="textinput" type="text" placeholder="https://mapage.html">
                                            </div>
                                            <div class="custom-control custom-switch">
                                                <input type="checkbox" class="custom-control-input" id="opt-showhelp">
                                                <label class="custom-control-label" for="opt-showhelp"><span i18n="tabs.app.opt_help">Afficher la page d'accueil au démarrage</span></label>
                                            </div>
                                        </div>
                                    </div>
                                </div>                                
                            </div>  
                            <!--./Page d'accueil-->

                            <div class="accordion mt-4" id="search-config">
                                <div class="accordion-item">
                                  <h2 class="accordion-header" >
                                    <a class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSearch" aria-expanded="true" aria-controls="collapseFondPlan">
                                      <div>
                                        <span class="title-accordion" i18n="tabs.app.search.title">Recherche</span><br>
                                        <span class="subtitle-accordion" i18n="tabs.app.search.subtitle">Paramétrer les fonctionnalités disponibles dans la barre de recherche</span>
                                      </div>
                                    </a>
                                  </h2>
                                  <div id="collapseSearch" class="accordion-collapse collapse" aria-labelledby="accordionSearch">
                                    <div class="accordion-body p-0"> 
                                        <ul class="list-group list-group-flush">     
                                            <li class="list-group-item">
                                                <div class="list-flex">
                                                    <p class="strong" i18n="tabs.app.search.address_search.title">Activer la recherche d'adresse</p>
                                                    <div class="custom-control custom-switch">
                                                        <input type="checkbox" class="custom-control-input" id="SwitchAdressSearch">
                                                        <label class="custom-control-label" for="SwitchAdressSearch"></label>
                                                    </div>
                                                </div>
                                                <div id="AppSearchBlock" style="display: none;">
                                                    <div class="row mb-2" >                                                    
                                                        <div class="col-md-12">
                                                            <label for="frm-searchlocalities" i18n="tabs.app.search.address_search.service" class="form-label">Service utilisé</label>
                                                            <select class="form-control b" id="frm-searchlocalities" name="searchlocalities" onchange="mv.changeSearchLocalities(this.value)">
                                                                <option value="ban" i18n="tabs.app.search.address_search.ban">Base Adresse Nationale</option>
                                                                <option value="custom" i18n="tabs.app.search.address_search.custom">Personnalisé</option>
                                                            </select>
                                                        </div>
                                                    </div>    
                                                    <div class="row my-2 align-items-stretch">
                                                            <div class="col-md-6" id="opt-searchl-url" style="display: none;">
                                                                <label for="opt-searchlocalities-url" i18n="tabs.app.search.address_search.url" class="form-label">URL</label>
                                                                <input class="form-control checkedurl" id="opt-searchlocalities-url" type="text" placeholder="Url du service">
                                                            </div>
                                                            <div class="col-md-6" id="opt-searchl-attribution" style="display: none;">
                                                                <label for="opt-searchlocalities-attribution" i18n="tabs.app.search.address_search.attribution" class="form-label">Attribution</label>
                                                                <input class="form-control" id="opt-searchlocalities-attribution" type="text"  placeholder="Attribution du service"  i18n="tabs.app.search.address_search.attribution.ph">
                                                            </div>   
                                                    </div>
                                                </div>                                                
                                            </li>
                                            <li class="list-group-item advanced" style="display: none;">
                                                <div class="list-flex">
                                                    <div>
                                                        <p class="strong" i18n="tabs.app.search.entity_search.activate">Activer la recherche d'entité</p>
                                                        <p i18n="tabs.app.search.entity_search.p1">La recherche peut être activée si la donnée est de type GEOJSON. Cette fonctionnalité est également activable pour les données de type WMS à la condition que les entités qui composent cette donnée soient également indéxées dans Elasticsearch.</p>
                                                    </div>
                                                    <div class="custom-control custom-switch">
                                                        <input type="checkbox" class="custom-control-input" id="opt-searchfeatures">
                                                        <label class="custom-control-label" for="opt-searchfeatures"></label>
                                                    </div>
                                                </div>                                                    
                                            </li>
                                          </ul>                                        
                                    </div>
                                  </div>
                                </div>                                
                            </div>  
                            <!--./Recherche-->                          
                                <div class="mt-4">
                                    <a class="btn btn-warning btnNext"><span i18n="studio.wizard.btn.next">Suivant</span> <i class="ri-arrow-right-line"></i> </a>
                                </div> 
                            </form> 
                        </div>
                        <!-- /.Application -->
                        <!-- Thématiques & données -->
                        <div class="tab-pane container fade" id="themesdata">
                            <h1><i class="ri-stack-line"></i> <span i18n="tabs.data.title">Thématiques & données</span></h1>   
                            <div class="row mt-5">
                                <div class="col-md-12">
                                    <ul class="list-group">
                                        <li class="list-group-item">
                                            <span class="title-accordion" i18n="tabs.data.themespanel.title">Panneau des thématiques</span><br>
                                            <span class="subtitle-accordion" i18n="tabs.data.themespanel.subtitle">Créer, importer et gérer vos thématiques et données</span>
                                        </li>
                                        <li class="list-group-item">
                                            <!-- List with handle -->
                                            <div id="themes-list" class="list-group"></div>
                                            <div class="my-3 text-right">
                                                <button id="btn-addTheme" i18n="modal.param.theme.new" title="Créer une nouvelle thématique" class="btn btn-info"
                                                        onclick="addTheme(mviewer.tr('modal.new.theme'), true, createId('theme'));">
                                                    <span><i class="bi bi-plus-lg"></i> </span>
                                                    <span i18n="tabs.data.themespanel.create">Créer</span>
                                                </button>
                                                <button id="btn-importTheme" title="Importer une thématique depuis un autre mviewer" class="btn btn-outline-info" onclick="$('#mod-themesview input').prop('checked', false);" data-bs-toggle="modal" data-bs-target="#mod-themesview">
                                                    <span><i class="bi bi-download"></i> </span>
                                                    <span i18n="tabs.data.themespanel.import">Importer</span>
                                                </button>
                                            </div>                                            
                                        </li>
                                        <li class="list-group-item list-flex">
                                            <span i18n="tabs.data.themespanel.options">Réduire le panneau des thématiques au démarrage</span>                                          
                                            <div class="custom-control custom-switch">
                                                <input type="checkbox" class="custom-control-input" name="checkboxes" id="opt-mini">
                                                <label class="custom-control-label" for="opt-mini"></label>
                                            </div>
                                        </li>
                                      </ul>
                                </div>
                            </div>                    
                    
                                                        
                            <div class="mt-4">
                                <a class="btn btn-outline-warning btnPrev"><i class="ri-arrow-left-line"></i> <span i18n="studio.wizard.btn.previous">Précédent</span></a>
                                <a class="btn btn-warning btnNext"><span i18n="studio.wizard.btn.next">Suivant</span> <i class="ri-arrow-right-line"></i> </a>
                            </div>  
                        </div>
                        <!-- /.Thématiques & données -->                     
                        <!-- / - Gestion des versions -->
                        <!-- Fonctionnalités avancées -->
                        <div class="tab-pane container fade advanced" id="fadanced" style="display: none">
                            <h1><i class="ri-list-settings-line"></i> <span i18n="tabs.adv.title">Fonctionnalités avancées</span></h1>
                            <div class="alert alert-info text-info my-3" role="alert">
                                <i class="bi bi-exclamation-circle"></i> 
                                <span i18n="tabs.adv.alert">Le paramétrage de cette section est optionnel.</span>
                            </div>

                            <!--Recherche ElasticSearch-->
                            <div class="accordion mt-4" id="accordionElasticSearch">
                                <div class="accordion-item">
                                  <h2 class="accordion-header" >
                                    <a class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseElasticSearch" aria-expanded="true" aria-controls="collapseElasticSearch">
                                      <div>
                                        <span class="title-accordion" i18n="tabs.search.elastic_search.title">ElasticSearch</span></br>
                                        <span class="subtitle-accordion" i18n="tabs.search.elastic_search.subtitle">Paramétrer une recherche basée sur un index Elasticsearch</span>
                                      </div>
                                    </a>
                                  </h2>
                                  <div id="collapseElasticSearch" class="accordion-collapse collapse" aria-labelledby="accordionElasticSearch">
                                    <div class="accordion-body p-0"> 
                                        <ul class="list-group list-group-flush">
                                            <li class="list-group-item">
                                                <div id="FadvElasticBlock">
                                                    <form>
                                                        <div class="row mt-2" >
                                                            <div class="col-md-12">
                                                                <p class="strong" i18n="tabs.search.elastic_search.activate">Activer la recherche ElasticSearch</p>
                                                                <select id="frm-globalsearch" name="globalsearch" class="form-control"
                                                                        onchange="mv.changeGlobalSearch(this.value)">
                                                                    <option value="false" i18n="tabs.search.elastic_search.disabled">Non utilisé</option>
                                                                    <option value="elasticsearch" i18n="tabs.search.elastic_search.enabled">Activé</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="row mt-2" >
                                                            <div class="col-md-6">
                                                                <label for="opt-elasticsearch-url"  i18n="tabs.search.elastic_search.es_url" class="form-label">URL Elasticsearch</label>
                                                                <input class="form-control" id="opt-elasticsearch-url" type="text" i18n="tabs.search.elastic_search.es_url.ph" placeholder="URL Elasticsearch">
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label for="opt-elasticsearch-geometryfield" i18n="tabs.search.elastic_search.geom_field" class="form-label">Geometryfield</label>
                                                                <input class="form-control" id="opt-elasticsearch-geometryfield" type="text" placeholder="geometryfield">
                                                            </div>
                                                        </div>
                                                        <div class="row mt-2" >   
                                                            <div class="col-md-6">
                                                                <label for="opt-elasticsearch-linkid" i18n="tabs.search.elastic_search.linkid" class="form-label">linkid</label>
                                                                <input class="form-control" id="opt-elasticsearch-linkid" type="text" placeholder="linkid">
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label for="opt-elasticsearch-doctypes" i18n="tabs.search.elastic_search.doctypes" class="form-label">Doctypes</label>
                                                                <input class="form-control" id="opt-elasticsearch-doctypes" type="text" placeholder="doctypes">
                                                            </div>
                                                        </div>
                                                        <div class="row mt-2" >                                                    
                                                            <div class="col-md-6">
                                                                <label for="opt-elasticsearch-querymode" i18n="tabs.search.elastic_search.qmode" class="form-label">Mode</label>
                                                                <select id="opt-elasticsearch-querymode" class="form-control">
                                                                    <option value="match" i18n="tabs.search.elastic_search.qmode_match">match</option>
                                                                    <option value="term" i18n="tabs.search.elastic_search.qmode_term">term</option>
                                                                    <option value="phrase" i18n="tabs.search.elastic_search.qmode_phrase">phrase</option>
                                                                </select>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label for="opt-elasticsearch-version" i18n="tabs.search.elastic_search.version" class="form-label">Version</label>
                                                                <select id="opt-elasticsearch-version" class="form-control">
                                                                    <option value="current" i18n="tabs.search.elastic_search.v_current">current</option>
                                                                    <option value="1.4" i18n="tabs.search.elastic_search.v_1_4">1.4</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="row mt-2">
                                                            <div class="col-md-12">
                                                                <div class="custom-control custom-switch">
                                                                    <input type="checkbox" class="custom-control-input" id="opt-elasticsearch-bbox" value="0">
                                                                    <label class="custom-control-label" for="opt-elasticsearch-bbox"></label>
                                                                    <span i18n="tabs.search.elastic_search.search_in_map_extent">Rechercher dans l'emprise de la carte</span>
                                                                </div>
                                                            </div>                                                        
                                                        </div>
                                                    </form>                                                                                                        
                                                </div>                                                
                                            </li>
                                          </ul>                                        
                                    </div>
                                  </div>
                                </div>                     
                            </div> 
                            <!--./Recherche ElasticSearch-->
                            
                            <div class="mt-4">
                                <a class="btn btn-outline-warning btnPrev"><i class="ri-arrow-left-line"></i> <span i18n="studio.wizard.btn.previous">Précédent</span></a>
                                <a class="btn btn-warning btnNext"><span i18n="studio.wizard.btn.next">Suivant</span> <i class="ri-arrow-right-line"></i> </a>
                            </div>  
                        </div>                       
                        <!-- /.Fonctionnalités avancées -->
                        <!-- Publication -->
                        <div class="tab-pane container fade" id="publication">
                            <h1 i18n="tabs.publication.finish">Félicitations !</h1>
                            <h4 class="text-primary" i18n="tabs.publication.subfinish">Vous avez terminé la configuration de votre application mviewer.</h4>  
                            <div id="cardsPublication" class="my-5">
                                <!--Publish-->
                                <div style="max-width: 18rem;" id="onlineCard">
                                    <a role="button" onclick="mv.showNamePublishModal(config?.id)" href="#">
                                        <div class="card text-white bg-warning p-3 zoomCard h-100 noborder" style="max-width: 18rem;">
                                            <div class="card-body mb-5">
                                            <span class="iconCard-finish">
                                                <i class="ri-play-line" style="font-size: 20px;vertical-align: middle;"></i>
                                            </span>                            
                                            <h5 class="card-title mt-4"><span i18n="tabs.publication.publish_title">Publier votre application</span></h5>
                                            <p class="card-text" i18n="tabs.publication.publish_text">Mettre en ligne votre application et obtenez un lien de partage</p>                              
                                            </div>
                                        </div>
                                    </a> 
                                </div>
                                <!--Publish-->
                                <!--Download-->
                                <div style="max-width: 18rem;">
                                    <a role="button" onclick="downloadXML();" href="#">
                                        <div class="card text-white bg-info p-3 zoomCard h-100 noborder" style="max-width: 18rem;">
                                            <div class="card-body mb-5">
                                            <span class="iconCard-finish">
                                                <i class="ri-download-line" style="font-size: 20px;vertical-align: middle;"></i>
                                            </span>                            
                                            <h5 class="card-title mt-4"><span i18n="tabs.publication.download_title">Télécharger votre application</span></h5>
                                            <p class="card-text" i18n="tabs.publication.download_text">Télécharger le fichier de configuration .XML</p>                              
                                            </div>
                                        </div>
                                    </a> 
                                </div>
                                <!--Download-->
                                <!--Preview-->
                                <div style="max-width: 18rem;">
                                    <a role="button" onclick="previewAppsWithoutSave(config?.id, true)" href="#">
                                        <div class="card border-info p-3 zoomCard h-100" style="max-width: 18rem;">
                                            <div class="card-body mb-5">
                                            <span class="iconCard-finish" style=" background-color: #934de236;">
                                                <i class="ri-eye-2-line" style="font-size: 20px;vertical-align: middle;"></i>
                                            </span>                            
                                            <h5 class="card-title mt-4"><span i18n="tabs.publication.preview_title">Prévisualiser votre application</span></h5>
                                            <p class="card-text" i18n="tabs.publication.preview_text">Tester et valider votre configuration en live</p>                              
                                            </div>
                                        </div>
                                    </a> 
                                </div>                                
                                <!--Preview-->
                            </div>                          
                            <div class="mt-4">
                                <a class="btn btn-outline-warning btnPrev"><i class="ri-arrow-left-line"></i> <span i18n="studio.wizard.btn.previous">Précédent</span></a>
                            </div>  
                        </div>
                        <!-- /.Publication -->
                    </div>  
                    <!--/.STUDIO TABS-->
                </div>
                <!-- /CONTAINER STUDIO -->
            </div>
        </div>
        <!-- /.MODULES STUDIO--> 
        <div id="liveAlertPlaceholder"></div>  
    </main>
    
    <!-- MODALS -->
    <!-- Modal theme options-->
    <div class="modal fade" id="mod-themeOptions" role="dialog" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="mod-themeOptions" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" i18n="modal.theme.paramspanel.title">Paramètres de la thématique sélectionnée</h5>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body" id="theme-edit" data-themeid="">
                    <div class="row mb-3">
                        <div class="col-md-6">                            
                            <label for="theme-edit-title" class="form-label" i18n="modal.theme.paramspanel.name">Nom</label>
                            <input type="text" id="theme-edit-title" class="form-control" tabs.search.elastic_search.disabled="Titre">
                            <div class="custom-control custom-switch mt-2">
                                <input type="checkbox" class="custom-control-input" id="theme-edit-collapsed">
                                <label class="custom-control-label" for="theme-edit-collapsed"><span i18n="modal.theme.paramspanel.opt_unfolded">Déroulée par défaut</span></label>
                            </div>
                        </div>
                        <div class="col-md-6">                            
                            <div class="form-group">
                                <label class="settinglabel" i18n="modal.theme.paramspanel.icon">Icône</label>
                                <span class="selected-icon"></span>
                                <input type="text" class="icon-class-input form-control advanced"  style="display: none;" id="theme-pick-icon" />
                                <button type="button" class="btn btn-outline-info picker-button mt-2">
                                    <span i18n="modal.theme.paramspanel.icon_pick">Choisir une icône</span>
                                </button>                               
                            </div>
                        </div>                        
                    </div>
                    <hr>
                    <h6 class="my-2" i18n="modal.theme.paramspanel.data">Données de la thématique</h6>
                    <!-- List with handle -->
                    <div id="themeLayers" class="list-group my-2"></div>
                    <div class="my-3">
                        <button id="btn-addLayer" class="btn btn-info" onclick="addLayer(mviewer.tr('title.new.layer'));" data-bs-target="#mod-layerNew" data-bs-toggle="modal">
                            <i class="bi bi-plus-lg"></i>
                            <span i18n="modal.theme.paramspanel.add_data">Ajouter des données</span>
                        </button>
                    </div>             
                </div>
                <div class="modal-footer">
                    <button id="btn-saveTheme" class="btn btn btn-primary" onclick="mv.saveAllThemes();">
                        <span i18n="save">Enregistrer</span>
                    </button>
                    <button type="button" class="btn btn-outline-primary" data-bs-dismiss="modal" i18n="cancel">Annuler</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal theme options-->
    <div class="modal fade" id="mod-themeExtOptions" role="dialog" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="mod-themeExtOptions" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" i18n="modal.theme.paramspanel.title">Paramètres de la thématique sélectionnée</h5>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body" id="themeExt-edit" data-themeid="">
                    <div class="row" > 
                        <div class="col-md-12">
                            <div>
                                <span class="titleExtModal" id="nameThemeExt"></span>
                                <span class="theme-infos-layer">Ext.</span>
                            </div>                                                     
                        </div>                                                   
                        <div class="col-md-12 mt-3">
                            <label for="themeext-layersvisibility" class="form-label" i18n="modal.themeEx.paramspanel.layervisibility">Affichage des données de la thématique au démarrage de l'application :</label>
                            <select id="themeext-layersvisibility" class="form-control">
                                <option value="default" i18n="modal.themeEx.paramspanel.default">Par défaut (comme défini dans l'application source)</option>
                                <option value="all" i18n="modal.themeEx.paramspanel.all">Toutes les données sont affichées</option>
                                <option value="none" i18n="modal.themeEx.paramspanel.none">Aucune donnée n'est affichée</option>
                            </select>
                        </div>
                    </div>                                
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-primary" data-bs-dismiss="modal" i18n="cancel">Annuler</button>
                    <button id="btn-saveTheme" class="btn btn btn-primary" onclick="saveThemeExt();">
                        <span i18n="validate">Valider</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Credits-->
    <div class="modal fade" id="modalCredits" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="modalCredits" aria-hidden="true">
        <div class="modal-dialog ">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><span i18n="modal.credits.title">Crédits</span></h5>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body">
                    <p id="creditInfo">MviewerStudio | Licence GPL-3.0 | Version</p>
                    <div class="alert alert-info text-info my-2" role="alert">
                        <i class="ri-information-line" style="font-size: 20px;vertical-align: middle;"></i>
                        <span id="mviewerCompliantInfo">Compatible à partir de la version mviewer</span> 
                    </div>
                    <p><span class="strong" i18n="modal.credits.lib">Librairies</span><br>Bootstrap 5.2.0 | OpenLayers 7.1</p>
                    <p><span class="strong" i18n="modal.credits.icon">Icônes</span><br>Remix Icon | Bootstrap Icons </p>
                    <p><span class="strong" i18n="modal.credits.draw">Illustrations</span><br>VectorJuice sur Freepik.com</p>
                    <p><span class="strong" i18n="modal.credits.funder">Illustrations</span><br></p>
                    <div class="row credits">
                        <div class="col"><img src="https://upload.wikimedia.org/wikipedia/fr/thumb/8/83/R%C3%A9gion-bretagne-logo.svg/132px-R%C3%A9gion-bretagne-logo.svg.png" ></div>
                        <div class="col"><img src="https://www.hauteloire.fr/sites/cg43/local/cache-vignettes/L227xH85/logo-dept43_2018-85462.jpg"></div>
                        <div class="col"><img src="https://www.amenagement-numerique.gouv.fr/files/2021-06/megalis_logo.png"></div>
                    </div>
                        <div class="row credits">
                        <div class="col"><img src="img/Logo_France_Relance_vert.svg" ></div>
                        <div class="col"><img src="img/FRFinanceEU_BLACK Outline.png"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal"><span i18n="close">Fermer</span></button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal exitStudio-->
    <div class="modal fade" id="mod-closeStudio" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="mod-closeStudio" aria-hidden="true">
        <div class="modal-dialog ">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" i18n="modal.exit.title">Attention</h5>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body">
                    <p i18n="modal.exit.subtitle">Êtes-vous sûr de vouloir quitter votre projet en cours ?</p>
                    <a class="cardsClose save-close zoomCard" onclick="saveStudio(true);">
                        <i class="ri-save-line"></i>
                        <span i18n="modal.exit.save">Enregister mon application et quitter le studio</span>
                    </a>
                    <a class="cardsClose notsave-close zoomCard" onclick="showHome()">
                        <i class="bi bi-x-circle"></i>
                        <span i18n="modal.exit.notsave">Ne pas sauvegarder mes modifications et quitter le studio</span>
                    </a>
                    <a class="returnConf-close" data-bs-dismiss="modal" aria-label="Close"><i class="ri-arrow-left-line"></i> <span i18n="modal.exit.previous">Retour</span></a>                    
                </div>
            </div>
        </div>
    </div>

    <!-- Modal user group selection-->
    <div class="modal fade" id="mod-groupselection" data-bs-backdrop="static" data-bs-keyboard="false" role="dialog" tabindex="-1" aria-labelledby="mod-importfile" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" i18n="modal.group.select">Sélectionner un groupe</h5>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>                    
                </div>
                <div class="modal-body">
                    <p i18n="modal.group.description">Vous appartenez à plusieurs groupes. Vous devez en sélectionner un pour créer ou enregistrer une carte associée à celui-ci.</p>
                    <div class="list-group" id="user_group_list"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal file import-->
    <div class="modal fade" id="mod-importfile" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="mod-importfile" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" i18n="modal.file.import">Ouvrir un projet existant</h5>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body">
                    <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
                        <li class="nav-item" role="presentation">
                          <a class="nav-link active" data-bs-toggle="pill" data-bs-target="#serverside" type="button" role="tab" aria-controls="pills-serverside" aria-selected="true">
                                <span i18n="modal.file.serverside">Sur le serveur</span> 
                          </a>
                        </li>
                        <li class="nav-item" role="presentation">
                          <a class="nav-link" onclick="mv.cleanLocalFileField(this)"data-bs-toggle="pill" data-bs-target="#local" type="button" role="tab" aria-controls="pills-local" aria-selected="false">
                            <span i18n="modal.file.local">Depuis votre ordinateur</span> 
                          </a>
                        </li>
                      </ul>
                      <div class="tab-content mb-4">
                        <div class="tab-pane fade show active" id="serverside" role="tabpanel" tabindex="0">
                            <div id="applicationsListFilters" class="row">
                                <div class="col-md-6 pb-2" style="display: none;">
                                    <label for="apps_group_list" i18n="modal.file.group">Groupe</label>
                                    <select class="form-control" id="apps_group_list" onchange="mv.onSearchApp(this)"></select>
                                </div>
                                <div class="col-md-12 pb-2" style="display: none;">
                                    <label for="apps_creator_list" i18n="modal.file.author">Auteur</label>
                                    <select class="form-control" id="apps_creator_list" onchange="mv.onSearchApp(this)"></select>
                                </div>
                                <div class="col-md-12 pb-2" id="searchBydescriptionInput">
                                <label i18n="modal.file.selectserverside">Filtrer par description:</label>
                                    <div class="input-group search-apps-ui">
                                        <input autocomplete="off" onchange="mv.onSearchApp(this)" type="text" class="form-control" id="appListSearch" i18n="load.app.ph.search" placeholder="Saisir un nom, un mot clé, une date...">
                                        <div class="input-group-append">
                                            <button onclick="mv.onSearchApp(appListSearch)" class="btn btn-info"><i class="ri-search-2-line"></i></button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <form class="row mb-2">
                                <div class="col-md-12">
                                    <strong i18n="modal.list.selectapp">Sélectionner une application :</strong>
                                </div>
                            </form>
                            <div class="list-group mb-3" id="liste_applications">
                            </div>
                            <div class="text-right d-none" id="deleteAllBtn">
                                <button type="button" class="btn btn btn-outline-danger" onclick="deleteMyApplications();">
                                    <i class="ri-delete-bin-2-line"></i>
                                    <span i18n="modal.file.deleteallmyapps">Supprimer toutes mes applications</span>
                                </button>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="local" role="tabpanel" tabindex="0">
                            <label i18n="modal.file.selectlocal">Sélectionner un fichier de configuration .XML :</label>
                            <div class="input-group mb-3">
                                <input type="text" class="form-control" i18n="load.app.file.ph" placeholder="monapplication.xml" aria-describedby="button-addon2">
                                <div class="input-group-append">
                                    <button class="btn btn-info" type="button" onclick="$('#filebutton').click();">
                                        <i class="bi bi-folder2-open"></i>
                                        <span i18n="modal.file.browse">Parcourir</span>
                                    </button>
                                </div>                                
                            </div>
                            <input type="file" name="filebutton" style="display: none;" id="filebutton">
                        </div>
                      </div>
                </div>
                <div class="modal-footer">

                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal"><span i18n="close">Fermer</span></button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal layer options-->
    <div class="modal fade" id="mod-layerOptions" role="dialog" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="mod-layerOptions" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header align-items-center">
                    <h5 class="modal-title" i18n="modal.layer.edit">Paramètres de la donnée</h5>
                    <span id="layerTypeLabel"></span>
                    <button type="button" class="close" data-bs-target="#mod-themeOptions" data-bs-toggle="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body">
                    <ul class="nav nav-pills mb-3" id="layer_sections_menu" role="tablist">
                        <li class="nav-item" role="presentation">
                          <a class="nav-link active" data-bs-toggle="pill" data-bs-target="#layer_conf1" type="button" role="tab" aria-controls="pills-layer_conf1" aria-selected="true" i18n="modal.layer.edit.base">
                              Général
                          </a>
                        </li>
                        <li class="nav-item advanced" role="presentation" style="display: none;">
                          <a class="nav-link" data-bs-toggle="pill" data-bs-target="#layer_conf3" type="button" role="tab" aria-controls="pills-layer_conf3" aria-selected="false" i18n="modal.layer.edit.display">
                            Options avancées
                          </a>
                        </li>
                        <li class="nav-item" role="presentation">
                          <a class="nav-link" onclick="mv.openTemplateGenerator()" data-bs-toggle="pill" data-bs-target="#layer_conf2" type="button" role="tab" aria-controls="pills-layer_conf2" aria-selected="false" i18n="modal.layer.edit.sheet">
                            Interrogation
                          </a>
                        </li>
                        <li class="nav-item advanced layerOption-wms" role="presentation" style="display: none;">
                          <a class="nav-link" data-bs-toggle="pill" data-bs-target="#layer_conf4" type="button" role="tab" aria-controls="pills-layer_conf4" aria-selected="false" i18n="modal.layer.edit.filter">
                            Filtre statique
                          </a>
                        </li>
                        <li class="nav-item layerOption-wms" role="presentation">
                          <a class="nav-link" data-bs-toggle="pill" data-bs-target="#layer_conf5" type="button" role="tab" aria-controls="pills-layer_conf5" aria-selected="false" i18n="modal.layer.edit.choices">
                            Filtre dynamique
                          </a>
                        </li>
                        <li class="nav-item advanced layerOption-wms" role="presentation" style="display: none;">
                          <a class="nav-link" data-bs-toggle="pill" data-bs-target="#layer_conf6" type="button" role="tab" aria-controls="pills-layer_conf6" aria-selected="false" i18n="modal.layer.edit.search">
                            Recherche
                          </a>
                        </li>
                    </ul>
                    <div class="tab-content mt-3" id="layer_sections">
                        <div role="tabpanel" class="tab-pane fade show active" id="layer_conf1">
                            <form>
                                <div class="my-2">
                                    <div class="form-group">
                                        <label for="frm-layer-title" i18n="modal.layer.name">Nom</label>
                                        <input type="text" class="form-control" id="frm-layer-title"
                                               placeholder="nom de la couche" i18n="modal.layer.name.ph">
                                    </div>
                                    <div class="form-group">
                                        <label for="frm-attribution"><span i18n="modal.layer.attr">Attribution</span><span class="tooltip-info" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="tooltip.data.source"><i class="ri-information-line"></i></label>
                                        <input type="text" class="form-control" id="frm-attribution"
                                               placeholder="Attribution">
                                    </div>
                                    <div class="form-group" lang="en-US">
                                        <label for="frm-opacity" i18n="modal.layer.opacity">Opacité </label><span id="opacity-value">1</span>
                                        <input type="range" class="form-control-range mt-1" id="frm-opacity" step="0.1" min="0" max="1" value="1">
                                        
                                    </div>
                                    <div class="form-group mt-4">
                                        <div class="custom-control custom-switch">
                                            <input type="checkbox" class="custom-control-input" id="frm-visible">
                                            <label class="custom-control-label" for="frm-visible" i18n="modal.layer.visibleonstart">Afficher la donnée au démarrage de l'application</label>
                                        </div>
                                        <div class="custom-control custom-switch">
                                            <input type="checkbox" class="custom-control-input" id="frm-layer-toplayer">
                                            <label class="custom-control-label" for="frm-layer-toplayer" i18n="modal.layer.toplayer">Afficher la donnée en première position de la carte</label><span class="tooltip-info" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="tooltip.toplayer"><i class="ri-information-line"></i>
                                        </div>
                                    </div>
                                    <div class="mt-4 layerOption-wms d-none">                                        
                                        <h6 i18n="modal.layer.styles">Style(s) de la donnée disponible(s)</h6>
                                        <p><small><span i18n="modal.layer.styles.note">Si plusieurs styles sont sélectionnés, indiquer les libéllés des styles qui apparaîtront dans la liste déroulante.</span></small></p>
                                        <div class="row mt-3" id="frm-lis-styles"></div>                                        
                                    </div>                                    
                                    <div class="form-group layerOption-wms d-none" id="formLayerStyleTitle">
                                        <label for="frm-layer-styletitle" ><span i18n="modal.layer.style.title">Libellé de la liste déroulante des styles</span><span class="tooltip-info" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="tooltip.analyse"><i class="ri-information-line"></i></label>
                                        <input type="text" class="form-control" id="frm-layer-styletitle" placeholder="Libellé de la liste des styles" i18n="modal.layer.style.placeholder">
                                    </div>  
                                    <div class="mt-4 layerOption-tms d-none">                                        
                                        <h6>Style de la donnée</h6>  
                                        <div class="form-group">
                                            <label for="frm-layertms-styleurl" i18n="modal.layer.new.param.tms.styleurl">Lien vers le fichier de style (JSON)</label>
                                            <input type="text" class="form-control checkedurl" id="frm-layertms-styleurl" placeholder="Url vers le fichier de style">
                                        </div>
                                        <div class="form-group">
                                            <label for="frm-layertms-stylename"><span i18n="modal.layer.new.param.tms.style">Nom du style</span><span class="tooltip-info" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="tooltip.style"><i class="ri-information-line"></i></label>
                                            <input type="text" class="form-control" id="frm-layertms-stylename" placeholder="BD Topo">
                                        </div>    
                                        <div class="form-group">
                                            <label for="frm-layertms-filterstyle"><span i18n="modal.layertms.filterstyle">Indiquer le nom des couches à masquer dans le style</span><span class="tooltip-info" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="tooltip.separator"><i class="ri-information-line"></i></label>
                                            <input type="text" class="form-control" id="frm-layertms-filterstyle" placeholder="BD Topo">
                                        </div>                                    
                                    </div>                              
                                </div>
                            </form>                            
                        </div>
                        <div role="tabpanel" class="tab-pane fade" id="layer_conf2">                            
                            <form>
                                <div class="form-group">
                                    <div class="custom-control custom-switch mt-2">
                                        <input type="checkbox" class="custom-control-input" id="frm-queryable">
                                        <label class="custom-control-label" for="frm-queryable"><span i18n="modal.layer.queryable">Activer l'interrogation de la donnée au clic sur la carte</span></label>
                                    </div>
                                </div>
                                <div class="row layerOption-wms d-none">                                    
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="control-label" for="frm-infopanel" i18n="modal.layer.info.position">Position de la fiche d'information</label>
                                            <select id="frm-infopanel" onchange="mv.openTemplateGenerator()" class="form-control">
                                                <option value="right-panel" i18n="modal.layer.info.right">Panneau de droite</option>
                                                <option value="bottom-panel" i18n="modal.layer.info.down">Panneau du bas</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group advanced" style="display: none;">
                                            <label for="frm-featurecount" i18n="modal.layer.featurecount">Limitation du nombre de réponses</label><span class="tooltip-info" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="tooltip.max.features"><i class="ri-information-line"></i>
                                            <input type="number" class="form-control" id="frm-featurecount"
                                                   placeholder="Nombre max d'entités retournées" step="1" min="1"
                                                    i18n="modal.layer.featurecount.ph" max="50" value="5">
                                        </div>
                                    </div>                                    
                                </div>
                                <div class="row layerOption-wms d-none">
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label class="control-label" for="frm-infoformat" i18n="modal.layer.infoformat">Format de la fiche
                                                d'information</label>
                                            <select id="frm-infoformat" class="form-control"
                                                    onchange="mv.showHideQueryParameters(this.value);">                                                
                                                <option value="application/vnd.ogc.gml" i18n="modal.layer.infoformat.gml">Personnalisé</option>
                                                <option value="text/html" i18n="modal.layer.infoformat.html">Standard</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <div id="query-parameters" class="layerOption-wms d-none">
                                    <!--LayerTempl-->
                                    <div id="templateGeneratorEdit">
                                        <ul class="list-group">
                                            <li id="headerTemplateArea" class="list-group-item justify-content-between align-items-center">
                                                <div>
                                                    <span class="title-accordion" i18n="modal.layer.customtemplate.title">Configurer la fiche d'information</span></br>
                                                    <span class="subtitle-accordion" i18n="modal.layer.customtemplate.subtitle">Sélectionner les champs à afficher et leurs aspects</span>
                                                </div>
                                            </li>
                                            <li id="newCustomTemplateManager" class="list-group-item justify-content-between align-items-center d-none">
                                                <div>
                                                    <span i18n="modal.layer.customtemplate.new">Créer une fiche d'information personnalisée</span>
                                                </div>
                                                <div>
                                                    <button type="button" class="btn btn-sm btn-outline-info" data-bs-toggle="modal" data-bs-target="#templageGeneratorModal">
                                                        <span class="layer-edit" title="Editer une nouvelle fiche"><i class="bi bi-plus-lg" style="margin-right:5px"></i><span i18n="modal.layer.customtemplate.create">Créer</span></span>
                                                    </button>
                                                </div>
                                            </li>
                                            <li id="customTemplateManager" class="list-group-item justify-content-between align-items-center d-none">
                                                <div>
                                                    <span i18n="modal.layer.customtemplate.nametemplate">Fiche d'information personnalisée</span>
                                                </div>
                                                <div>
                                                    <button type="button" class="btn btn-sm btn-secondary" onclick="mv?.templateGenerator.removeTemplate()">
                                                        <span class="layer-remove" title="Supprimer"><i class="bi bi-x-circle"></i></span>
                                                    </button>
                                                    <button type="button" class="btn btn-sm btn-info" data-bs-toggle="modal" data-bs-target="#templageGeneratorModal">
                                                        <span class="layer-edit" title="Editer cette fiche"><i class="bi bi-gear-fill"></i></span>
                                                    </button>
                                                </div>
                                            </li>
                                            <li  id="dismissTemplateGeneratorMsg" class="list-group-item justify-content-between align-items-center d-none">
                                                <div>
                                                    <span class="title-accordion" i18n="modal.layer.customtemplate.phpmsg">Sélectionner les champs à afficher et leurs aspects</span>
                                                </div>
                                            </li>
                                        </ul>
                                    </div>
                                    <!--./LayerTempl-->
                                    <!--Mustache-->
                                    <div class="accordion mt-2 advanced" id="accordionMustache" style="display: none;">
                                        <div class="accordion-item">
                                        <h2 class="accordion-header" >
                                            <a class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseMustache" aria-expanded="true" aria-controls="collapseMustache">
                                            <div>
                                                <span class="title-accordion" i18n="modal.layer.query.useexternaltemplate">Utiliser un template externe</span>
                                            </div>
                                            </a>
                                        </h2>
                                        <div id="collapseMustache" class="accordion-collapse collapse" aria-labelledby="accordionMustache">
                                            <div class="accordion-body"> 
                                                <div class="form-group">                                                    
                                                    <div class="custom-control custom-switch mb-2">
                                                        <input type="checkbox" class="custom-control-input" id="frm-template">
                                                        <label class="custom-control-label" for="frm-template"><span i18n="modal.layer.query.useexternaltemplate">Utiliser un template externe</span></label>
                                                    </div>
                                                    <div>
                                                        <label for="frm-template-url" i18n="modal.layer.query.templateurl">Lien vers le template .mst</label>
                                                        <input type="text" class="form-control checkedurl" id="frm-template-url" placeholder="https://montemplate.fr"/>
                                                    </div>                                                    
                                                </div>                                                                                                                            
                                            </div>
                                        </div>
                                        </div>
                                    </div>
                                    <!--./Mustache-->
                                </div>
                            </form>
                        </div>
                        <div role="tabpanel" class="tab-pane fade" id="layer_conf3">
                            <form>
                                <!--Affichage-->
                                <div class="accordion mt-2" id="accordionDisplayLayer">
                                    <div class="accordion-item">
                                    <h2 class="accordion-header" >
                                        <a class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDisplayLayer" aria-expanded="true" aria-controls="collapseDisplayLayer">
                                        <div>
                                            <span class="title-accordion" i18n="modal.layer.displayoptions.title">Options d'affichage</span>
                                        </div>
                                        </a>
                                    </h2>
                                    <div id="collapseDisplayLayer" class="accordion-collapse collapse show" aria-labelledby="accordionDisplayLayer">
                                        <div class="accordion-body">
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <label for="frm-layer-index"><span i18n="modal.layer.index">Index de couche</span><span class="tooltip-info" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="tooltip.indexlayer"><i class="ri-information-line"></i></label>
                                                    <input type="number" min="0" class="form-control" id="frm-layer-index" i18n="modal.layer.index"/>
                                                </div> 
                                                <div class="col-md-4 layerOption-wms d-none">
                                                    <label for="frm-scalemin"><span i18n="modal.layer.scale.min">Echelle mini</span><span class="tooltip-info" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="tooltip.scaleview"><i class="ri-information-line"></i></label>
                                                    <input type="number" class="form-control" id="frm-scalemin"
                                                        placeholder="Echelle mini" i18n="modal.layer.display.ph.minscale"/>
                                                </div>
                                                <div class="col-md-4 layerOption-wms d-none">
                                                    <label for="frm-scalemax"><span i18n="modal.layer.scale.max">Echelle maxi</span><span class="tooltip-info" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="tooltip.scaleview.max"><i class="ri-information-line"></i></label>
                                                    <input type="number" class="form-control" id="frm-scalemax"
                                                        placeholder="Echelle maxi" i18n="modal.layer.display.ph.maxscale"/>
                                                </div>
                                            </div>
                                            <div class="form-group mt-2">
                                                <div class="custom-control custom-switch">
                                                    <input type="checkbox" class="custom-control-input" id="frm-tiled">
                                                    <label class="custom-control-label" for="frm-tiled" i18n="modal.layer.tiled">Affichage tuilé</label>
                                                </div>
                                                <div class="custom-control custom-switch">
                                                    <input type="checkbox" class="custom-control-input" id="frm-layer-exclusive">
                                                    <label class="custom-control-label" for="frm-layer-exclusive" i18n="modal.layer.exclusive">Affichage exclusif de la donnée</label><span class="tooltip-info" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="tooltip.exclusivelayer"><i class="ri-information-line"></i>
                                                </div>
                                                <div class="custom-control custom-switch">
                                                    <input type="checkbox" class="custom-control-input" id="frm-layer-showintoc">
                                                    <label class="custom-control-label" for="frm-layer-showintoc" i18n="modal.layer.showintoc">Ne pas afficher la donnée dans la légende</label><span class="tooltip-info" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="tooltip.showintoc"><i class="ri-information-line"></i>
                                                </div>
                                            </div>                                            
                                            <div class="layerOption-wms d-none">   
                                                <hr>                                         
                                                <h6 for="frm-sld"><span i18n="modal.layer.sld.external">Utiliser un style externe</span><span class="tooltip-info" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="Lien vers un fichier au format .SLD définissant le style de la couche"><i class="ri-information-line"></i></h6>                                        
                                                <div class="input-group">
                                                    <input type="text" class="form-control checkedurl" id="frm-sld" placeholder="URL SLD externe" i18n="modal.layer.display.ph.external_sld">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    </div>                                
                                </div>  
                                <!--./Affichage-->
                                <!--Type de légende-->
                                <div class="accordion mt-2 layerOption-wms d-none" id="accordionOptionsLegend">
                                    <div class="accordion-item">
                                    <h2 class="accordion-header" >
                                        <a class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOptionsLegend" aria-expanded="true" aria-controls="collapseOptionsLegend">
                                        <div>
                                            <span class="title-accordion" i18n="modal.layer.title">Gestion de la légende</span>
                                        </div>
                                        </a>
                                    </h2>
                                    <div id="collapseOptionsLegend" class="accordion-collapse collapse" aria-labelledby="accordionOptionsLegend">
                                        <div class="accordion-body"> 
                                            <div class="row">
                                                <div class="col-md-12 form-group">
                                                    <label class="control-label" for="frm-legend" i18n="modal.layer.legend">Type de la légende</label>
                                                    <select id="frm-legend" name="type-legend" class="form-control" onchange="mv.changeLayerLegend(this.value);">
                                                        <option value="default" i18n="modal.layer.legend.default" selected>Par défaut</option>
                                                        <option value="custom" i18n="modal.layer.legend.custom">Personnalisée</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group" id="group-legend-default">
                                                <div class="custom-control custom-switch">
                                                    <input type="checkbox" class="custom-control-input" id="frm-layer-dynamiclegend">
                                                    <label class="custom-control-label" for="frm-layer-dynamiclegend" i18n="modal.layer.legend.dynamic">Adapter la légende selon les données visibles dans l'emprise de la carte</label>
                                                </div>
                                            </div>
                                            <div class="form-group mt-2 d-none" id="group-legend-custom">
                                                <label for="frm-legendurl" i18n="modal.layer.legendurl.text">Lien vers une légende personnalisée (image)</label>
                                                <input type="text" class="form-control checkedurl" id="frm-legendurl"
                                                placeholder="URL vers Image légende" i18n="modal.layer.legendurl.placeholder"/>
                                            </div>                          
                                        </div>
                                    </div>
                                    </div>                                
                                </div>  
                                <!--./Type de légende-->
                                <!--Type de couche-->
                                <div class="accordion mt-2" id="accordionOptionsType">
                                    <div class="accordion-item">
                                    <h2 class="accordion-header" >
                                        <a class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOptionsType" aria-expanded="true" aria-controls="collapseOptionsType">
                                        <div>
                                            <span class="title-accordion" i18n="modal.layer.type.title">Type de donnée</span>
                                        </div>
                                        </a>
                                    </h2>
                                    <div id="collapseOptionsType" class="accordion-collapse collapse" aria-labelledby="accordionOptionsType">
                                        <div class="accordion-body"> 
                                            <div class="row">
                                                <div class="col-md-6 form-group">
                                                    <label class="control-label" for="frm-type" i18n="modal.layer.type">Type</label>
                                                    <select id="frm-type" name="type" class="form-control"
                                                            onchange="mv.changeLayerType(this.value);">
                                                        <option value="wms" i18n="modal.layer.type.wms">WMS</option>
                                                        <option value="vector-tms">Vector-TMS</option>
                                                        <option value="geojson" i18n="modal.layer.type.geojson" disabled>GeoJSON</option>
                                                        <option value="kml" i18n="modal.layer.type.kml" disabled>KML</option>
                                                        <option value="customlayer" i18n="modal.layer.type.custom" disabled>Customlayer</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-6 form-group">
                                                    <label for="frm-layerid" i18n="modal.layer.id">id</label>
                                                    <input type="text" class="form-control" id="frm-layerid" placeholder="id">
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label for="frm-url" i18n="modal.layer.url">url</label>
                                                <input type="text" class="form-control checkedurl" id="frm-url"placeholder="url">
                                            </div>                                 
                                        </div>
                                    </div>
                                    </div>                                
                                </div>  
                                <!--./Type de couche-->
                                <!--Métadonnées-->
                                <div class="accordion mt-2" id="accordionMetadata">
                                    <div class="accordion-item">
                                    <h2 class="accordion-header" >
                                        <a class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseMetadata" aria-expanded="true" aria-controls="collapseMetadata">
                                        <div>
                                            <span class="title-accordion" i18n="modal.layer.metadata.title">Métadonnées</span>
                                        </div>
                                        </a>
                                    </h2>
                                    <div id="collapseMetadata" class="accordion-collapse collapse" aria-labelledby="accordionMetadata">
                                        <div class="accordion-body"> 
                                            <div class="form-group">
                                                <label for="frm-metadata" i18n="modal.layer.htmlmetadataurl">URL fiche de métadonnées (html)</label>
                                                <input type="text" class="form-control checkedurl" id="frm-metadata"
                                                    placeholder="metadata">
                                            </div>
                                            <div class="form-group">
                                                <label for="frm-metadata-csw" i18n="modal.layer.xmlmetadataurl">URL fiche de métadonnées (xml)</label>
                                                <input type="text" class="form-control checkedurl" id="frm-metadata-csw"
                                                    placeholder="metadata-csw">
                                            </div>                                                                               
                                        </div>
                                    </div>
                                    </div>                                
                                </div>  
                                <!--./Métadonnées-->
                                <!--Accès-->
                                <div class="accordion mt-2" id="accordionAccessLayer">
                                    <div class="accordion-item">
                                    <h2 class="accordion-header" >
                                        <a class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAccessLayer" aria-expanded="true" aria-controls="collapseAccessLayer">
                                        <div>
                                            <span class="title-accordion" i18n="modal.layer.access.title">Accès à la donnée</span>
                                        </div>
                                        </a>
                                    </h2>
                                    <div id="collapseAccessLayer" class="accordion-collapse collapse" aria-labelledby="accordionAccessLayer">
                                        <div class="accordion-body"> 
                                            <div class="form-group">
                                                <label class="control-label" for="frm-type" i18n="modal.layer.ac">Contraintes d'accès</label>
                                                <select id="frm-secure" name="type" class="form-control">
                                                    <option value="public" i18n="modal.layer.ac.public">Accès public</option>
                                                    <option value="global" i18n="modal.layer.ac.auth.global">Accès soumis à authentification globale (CAS georchestra)</option>
                                                    <option value="layer" i18n="modal.layer.ac.auth.service">Accès soumis à authentification au niveau du service (Basic Authent)</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <div class="custom-control custom-switch">
                                                    <input type="checkbox" class="custom-control-input" id="frm-useproxy">
                                                    <label class="custom-control-label" for="frm-useproxy" i18n="modal.layer.proxy">Utiliser le proxy du viewer (nécessaire si HTTPS non disponible pour la donnée)</label>
                                                </div>
                                            </div>                                                                               
                                        </div>
                                    </div>
                                    </div>                                
                                </div>  
                                <!--./Accès-->                                
                            </form>                            
                        </div>

                        <div role="tabpanel" class="tab-pane fade" id="layer_conf4">
                            <div class="well well-sm">
                                <p i18n="modal.layer.filter.serverside">
                                    Cette fonctionnalité permet de définir des conditions d'affichage des objets de la donnée, selon des valeurs attributaires
                                    ou une emprise géographique. Ce filtre statique ne peut pas être désactivé par vos utilisateurs au sein de l'application.
                                </p>
                                <div class="alert alert-info text-info my-2" role="alert">
                                    <i class="ri-information-line" style="font-size: 20px;vertical-align: middle;"></i>
                                    <span i18n="modal.layer.filter.geoserver-only-warning.txt">
                                        Cette fonctionnalité est basée sur un filtre CQL. Les filtres CQL ne peuvent activés qu'avec des données issues de Geoserver. 
                                        Il ne s'agit pas d'une fonction standard de WMS.
                                    </span>                                    
                                </div>
                            </div>                           
                            <form>
                                <div class="row mt-3">
                                    <div class="col-md-12">
                                        <label for="frm-filter" i18n="modal.layer.filter.serverside.active">Filtre actif</label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="input-group mb-3">
                                            <input type="text" type="textarea" class="form-control" id="frm-filter" placeholder="Expression CQL"  i18n="modal.layer.filter.cql.ph">
                                            <div class="input-group-append">
                                              <button class="btn btn-info" type="button" id="button-addon2" onclick="$('#filter_wizard').toggle();"><i class="bi bi-plus-lg"></i> <span i18n="modal.layer.filter.serverside.create">Créer un filtre</span></button>
                                            </div>
                                        </div>
                                    </div>                                    
                                </div>
                                <div id="filter_wizard" style="display:none;">                                    
                                    <ul class="nav nav-tabs mt-3" role="tablist">
                                        <li class="nav-item" role="presentation">
                                            <a class="nav-link active" aria-controls="attribute_filter" role="tab" data-bs-toggle="tab" data-bs-target="#attribute_filter" i18n="modal.layer.filter.serverside.filter.attributes">Filtre
                                            attributaire</a>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <a class="nav-link" aria-controls="geo_filter" role="tab" data-bs-toggle="tab" data-bs-target="#geo_filter" i18n="modal.layer.filter.serverside.filter.geo">Filtre                                         géographique</a>
                                        </li>
                                    </ul>
                                    <!-- Tab panes -->
                                    <div class="tab-content">
                                        <div role="tabpanel" class="tab-pane fade show active" id="attribute_filter">
                                            <div class="form-group mt-3">
                                                <label class="control-label" i18n="modal.layer.filter.fields">Champs</label>
                                                <select id="attribute_filter_fields" name="fields"
                                                        class="form-control"
                                                        onchange="extractFeatures(this.value, 'source')">
                                                </select>
                                            </div>                                            
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label class="control-label" i18n="modal.layer.filter.serverside.filter.operator">Opérateur</label>
                                                        <select id="attribute_filter_operators" name="operators" class="form-control">
                                                            <option value="=">=</option>
                                                            <option value="IN">IN</option>
                                                            <option value="NOT IN">NOT IN</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="control-label" i18n="modal.layer.filter.selected">Valeur(s) sélectionnée(s)</label>
                                                    <div class="form-group">
                                                        <input type="text" value="" data-role="tagsinput"
                                                               id="source_fields_tags" class="form-control"/>
                                                    </div>
                                                </div>
                                                
                                            </div>
                                            <div class="">
                                                <button type="button" onclick="mv.saveSourceAttributeFilter()"
                                                        class="btn btn-outline-info" i18n="modal.layer.filter.serverside.filter.apply">Appliquer le filtre
                                                </button>
                                            </div>
                                        </div>
                                        <div role="tabpanel" class="tab-pane fade" id="geo_filter">
                                            <div id="map_filter" class="map"></div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>

                        <div role="tabpanel" class="tab-pane fade" id="layer_conf5">
                            <div class="well well-sm">
                                <p i18n="modal.layer.filter.clientside">
                                    Cette fonctionnalité permet de pré-définir des conditions d'affichage attributaires des objets de la donnée. L'utilisateur pourra
                                    filtrer les entités selon les conditions définies ci-dessous à l'aide d'une liste déroulante disponible dans le bloc légende.
                                </p>
                                <div class="alert alert-info text-info my-2" role="alert">
                                    <i class="ri-information-line" style="font-size: 20px;vertical-align: middle;"></i>
                                    <span i18n="modal.layer.filter.geoserver-only-warning.txt">
                                        Cette fonctionnalité est basée sur un filtre CQL. Les filtres CQL ne peuvent activés qu'avec des données issues de Geoserver. 
                                        Il ne s'agit pas d'une fonction standard de WMS.
                                    </span>                                    
                                </div>
                            </div>
                            <form>
                                <div class="form-group mt-3">
                                    <div class="form-group">
                                        <label for="frm-attributelabel" i18n="modal.layer.filter.clientside.label">Nom du filtre</label>
                                        <input type="textarea" class="form-control" id="frm-attributelabel"
                                               placeholder="Texte à afficher" i18n="modal.layer.filter.clientside.label.ph">
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-md-6">
                                            <label class="control-label" i18n="modal.layer.filter.fields">Champs à filtrer</label>
                                            <select id="opt-attributefield" name="fields" class="form-control"
                                                    onchange="extractFeatures(this.value,'control')">
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="control-label" i18n="modal.layer.filter.selected">Valeur(s) sélectionnée(s)</label>
                                            <div class="form-group">
                                                <input type="text" value="" data-role="tagsinput" id="control_fields_tags" class="form-control"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>                            
                        </div>

                        <div role="tabpanel" class="tab-pane fade" id="layer_conf6">
                            <div class="alert alert-info text-info my-2" role="alert">
                                <i class="ri-information-line" style="font-size: 20px;vertical-align: middle;"></i>
                                <span i18n="modal.layer.search.alert">Pour utiliser cette fonctionnalité, les entités de la donnée doivent être indexées par ElasticSearch.</span>
                            </div>
                            <form>
                                <div class="form-group my-3">
                                    <div class="custom-control custom-switch">
                                        <input type="checkbox" class="custom-control-input" id="frm-searchable">
                                        <label class="custom-control-label" for="frm-searchable" i18n="modal.layer.search.enable">Activer la recherche pour cette donnée</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label" for="frm-searchengine" i18n="modal.layer.search.engine">Moteur de recherche</label>
                                    <select id="frm-searchengine" class="form-control"
                                            onchange="mv.changeSearchEngine(this.value)">
                                        <option value="elasticsearch" i18n="modal.layer.search.engine.es">Elasticsearch</option>
                                        <option value="fuse" i18n="modal.layer.search.engine.fuse" disabled>Fuse.js</option>
                                    </select>
                                </div>
                                <div id="fuse_options">
                                    <div class="form-group">
                                        <label for="frm-fusesearchkeys" i18n="modal.layer.search.fuse.fusesearchkeys">fusesearchkeys</label>
                                        <input type="text" class="form-control" id="frm-fusesearchkeys"
                                               placeholder="fusesearchkeys">
                                    </div>
                                    <div class="form-group">
                                        <label for="frm-fusesearchkeys" i18n="modal.layer.search.fuse.fusesearchresult">fusesearchresult</label>
                                        <input type="text" class="form-control" id="frm-fusesearchresult"
                                               placeholder="fusesearchresult">
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">                    
                    <button type="button" onclick="mv.form2xml()" data-bs-target="#mod-codeview" data-bs-toggle="modal" class="btn btn-outline-info advanced" i18n="view" style="display: none;">Voir</button>
                    <button type="button" onclick="mv.saveLayerOptions()" data-bs-target="#mod-themeOptions" data-bs-toggle="modal" class="btn btn-primary" i18n="save">Enregistrer</button>
                    <button type="button" class="btn btn-outline-primary" data-bs-target="#mod-themeOptions" data-bs-toggle="modal" i18n="close">Fermer</button>
                </div>
            </div>
        </div>
    </div>
   
    <!-- Modal codeView-->
    <div class="modal fade" id="mod-codeview" role="dialog" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="mod-codeview" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" i18n="modal.code.xml">Configuration XML</h5>
                    <button type="button" class="close" data-bs-target="#mod-layerOptions" data-bs-toggle="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <pre class="windows-code-XML"></pre>
                    </div><!-- /.row -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-primary" data-bs-target="#mod-layerOptions" data-bs-toggle="modal" i18n="close">Fermer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal featuresView-->
    <div class="modal fade" id="mod-featuresview" role="dialog" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="mod-featuresview" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" i18n="modal.features.select">Sélection des valeurs</h5>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-12">
                            <label class="control-label" i18n="modal.features.values">Sélectionner les valeurs sur lesquelles appliquer un filtre :</label>
                            <div id="distinct_values" class="list-group"></div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">                    
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Valider</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Themes import-->
    <div class="modal fade" id="mod-themesview" role="dialog" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="mod-themesview" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" i18n="modal.themes.select">Importer une thématique externe</h5>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-12">
                            <!--<div id="importedThemes" class="list-group">
                            </div>-->
                            <div id="themesListTable"></div>
                        </div>
                    </div><!-- /.row -->
                </div>
                  <div class="modal-footer">                    
                    <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="importThemes()" i18n="import">Importer</button>
                    <button type="button" class="btn btn-outline-primary" data-bs-dismiss="modal" i18n="close">Fermer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal new Layer-->
    <div class="modal fade" id="mod-layerNew" role="dialog" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="mod-layerNew" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" i18n="modal.layer.new.searchdata">Ajouter une donnée</h5>
                    <button type="button" class="close" data-bs-target="#mod-themeOptions" data-bs-toggle="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body">
                    <ul class="nav nav-pills mb-4" id="pills-tab-layers" role="tablist">
                        <li class="nav-item" role="presentation">
                              <a class="nav-link active" data-bs-toggle="pill" data-bs-target="#newlayer-catalog" type="button" role="tab" aria-controls="pills-newlayer-catalog" aria-selected="true" onclick="mv.resetConfLayer(); ">
                                    <span i18n="modal.layer.new.catalog">Depuis un catalogue</span> 
                              </a>
                        </li>
                        <li class="nav-item" role="presentation">
                              <a class="nav-link" data-bs-toggle="pill" data-bs-target="#newlayer-param" type="button" role="tab" aria-controls="pills-newlayer-param" aria-selected="false" onclick="mv.resetSearch();">
                                <span i18n="modal.layer.new.param">Via des paramètres</span> 
                              </a>
                        </li>
                    </ul>
                    <!-- Depuis un catalogue -->
                    <div class="tab-content mb-4">
                        <div class="tab-pane fade show active" id="newlayer-catalog" role="tabpanel" tabindex="0">
                            <div class="row">
                                <div class="col-md-12">
                                    <h6 i18n="modal.layer.new.searchdata.title">Rechercher une données</h6>
                                    <div class="input-group my-3">
                                        <input type="text" id="input-ogc-filter" class="form-control" aria-label="..." placeholder="Rechercher..." i18n="modal.layer.new.searchdata.ph">
                                        <div class="input-group-append">
                                            <button id="providers_dropdown" class="btn btn-outline-info dropdown-toggle noborderradius" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Catalogue de données</button>   
                                            <ul class="dropdown-menu dropdown-menu-end" id="providers_list"></ul>                     
                                            <button class="btn btn-info" id="provider_search_btn" type="button" disabled="enabled" onclick="mv.search()"><i class="bi bi-search"></i></button>
                                        </div> 
                                    </div>
                                </div>
                            </div>  
                            <div class="row" style="padding: 1rem;" id="search-message" i18n="modal.layer.new.provider.noneselected">
                                Sélectionner un catalogue de données
                            </div>
                            <div class="row ogc-results" id="csw-results" style="display: none;"></div>
                            <div class="row ogc-results" id="wms-results" style="display: none;"></div>
                            <div class="row ogc-results" id="wfs-results" style="display: none;"></div>
                            
                            <div class="advanced" style="display:none;">   
                                <hr>                    
                                <div class="row">                             
                                    <div class="col-md-12">
                                        <h6 i18n="modal.layer.new.provider.add">Ajouter un catalogue de données</h6>
                                        <div class="input-group my-3" id="addCatalogData">
                                            <input type="text" class="form-control custom-title" aria-label="..." placeholder="Nom" oninput="updateAddProviderButtonState(this);">
                                            <input type="text" class="form-control custom-url" aria-label="..." i18n="modal.layer.new.provider.ph" placeholder="URL du fournisseur" oninput="updateAddProviderButtonState(this);" >
                                            <select class="form-control">
                                                <option value="csw" i18n="modal.layer.new.provider.csw">CSW</option>
                                                <option value="wms" i18n="modal.layer.new.provider.wms">WMS</option>
                                            </select>
                                            <div class="input-group-append">                    
                                                <button class="btn btn-info" type="button" id="add_provider_btn" disabled onclick="addNewProvider(this);"><i class="bi bi-plus-lg"></i> <span i18n="add">Ajouter</span> </button> 
                                            </div> 
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div> 
                    <!-- Via des paramètres -->
                    <div class="tab-content mb-4">
                        <div class="tab-pane fade" id="newlayer-param" role="tabpanel" tabindex="0">
                                <h6 i18n="modal.layer.new.param.title">Paramètres de la nouvelle donnée</h6>
                                <div class="mt-3" id="newLayerByParam">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="form-group">
                                                <label class="control-label" for="newlayer-type" i18n="modal.layer.new.param.type">Type de la donnée</label>
                                                <select id="newlayer-type" name="infoformat" class="form-control" onchange="mv.selectNewDataTypeValue(this)">
                                                    <option value="" selected i18n="provider.select.type">Choisir un type</option>
                                                    <option value="wms">WMS</option>
                                                    <option value="vector-tms" >Vector-TMS</option>
                                                </select>
                                            </div>                                    
                                        </div> 
                                    </div>                                       
                                    <div class="row" id="commonParamType">
                                        <div class="col-md-6 d-none">
                                            <div class="form-group">
                                                <label class="control-label" for="newlayer-id" i18n="modal.layer.new.param.id">Identifiant</label>
                                                <input type="text" class="form-control" id="newlayer-id" placeholder="bdtopo">
                                            </div>                                    
                                        </div>
                                        <div class="col-md-6 d-none">
                                            <div class="form-group">
                                                <label class="control-label" for="newlayer-name" i18n="modal.layer.new.param.name">Nom</label>
                                                <input type="text" class="form-control" id="newlayer-name" placeholder="BD Topo">
                                            </div>                                    
                                        </div>
                                        <div class="col-md-12 d-none">
                                            <div class="form-group">
                                                <label class="control-label" for="newlayer-url" i18n="modal.layer.new.param.url">URL</label>
                                                <input type="text" class="form-control checkedurl" id="newlayer-url" placeholder="Lien vers la donnée">
                                            </div>                                    
                                        </div>
                                    </div>
                                    <div class="row">   
                                        <div class="col-md-6 d-none vector-tms-type param-type">
                                            <div class="form-group">
                                                <label class="control-label" for="newlayer-tms-styleurl" i18n="modal.layer.new.param.tms.styleurl">Lien vers le fichier de style (JSON)</label>
                                                <input type="text" class="form-control checkedurl" id="newlayer-tms-styleurl" placeholder="Lien vers la donnée">
                                            </div>                                    
                                        </div>
                                        <div class="col-md-6 d-none vector-tms-type param-type">
                                            <div class="form-group">
                                                <label class="control-label" for="newlayer-tms-style" i18n="modal.layer.new.param.tms.style">Nom du style</label>
                                                <input type="text" class="form-control" id="newlayer-tms-style" placeholder="Lien vers la donnée">
                                            </div>                                    
                                        </div>
                                    </div>
                                </div>     
                        </div>
                    </div>                         
                </div>
                <div class="modal-footer">                    
                    <button type="button" class="btn btn-primary" onclick="mv.getConfLayers();" i18n="select">Sélectionner</button>
                    <button type="button" class="btn btn-outline-primary" data-bs-target="#mod-themeOptions" data-bs-toggle="modal" i18n="close">Fermer</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal icon picker-->
    <div id="iconPicker" class="modal fade" role="dialog" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="iconPicker" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><span i18n="modal.icon.list">Sélectionner une icône</span></h5>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body" style="max-height: calc(100vh - 200px);overflow-y: auto;overflow-x: hidden;">
                    <div>
                        <ul class="icon-picker-list">
                            <li>
                                <a data-class="{{item}} {{activeState}}" data-index="{{index}}">
                                    <span class="{{item}}"></span>
                                    <span class="name-class">{{item}}</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" id="change-icon" class="btn btn-primary" aria-label="Close"><span i18n="validate"> Valider</span></button>
                    <button type="button" class="btn btn-outline-primary" data-bs-dismiss="modal" aria-label="Close" i18n="cancel">Annuler</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal versionApp-->
    <div class="modal fade" id="mod-appversions" role="dialog" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="mod-appversions" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" i18n="modal.appversion.title">Historique des modifications</h5>
                    <button type="button" class="close" onclick="mv.cleanVersionHistoryUI()" data-bs-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body">
                    <div id="appsListTable"></div>
                </div>
                <div class="modal-footer d-none">                    
                    <button id="validVersionFooterBtn" onclick="mv.createVersion()" type="button" class="btn btn-primary" i18n="save">Enregistrer</button>
                    <button id="cancelVersionFooterBtn" onclick="mv.cleanVersionHistoryUI()" type="button" class="btn btn-outline-primary" data-bs-dismiss="modal" aria-label="Close" i18n="cancel">Annuler</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal icons -->
    <div class="modal fade" id="iconsModal" role="dialog" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="iconsModal" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content" id="iconsModalContent">
            </div>
        </div>
    </div>
    <!-- Modal-->
    <div class="modal fade" id="genericModal" role="dialog" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="genericModal" aria-hidden="true">
        <div class="modal-dialog modal-md">
            <div class="modal-content" id="genericModalContent">
            </div>
        </div>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="templageGeneratorModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="templageGeneratorModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" i18n="template.title">Générateur de template</h5>
                    <button type="button" class="close" data-bs-toggle="modal" data-bs-target="#mod-layerOptions"><span aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body" id="templateConfigurator">
                    <div class="row">
                        <div class="col-md-12 mb-2 d-flex align-items-center badgeOptions"></div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 mb-2 d-flex justify-content-between align-items-center">
                            <h6 class="m-0" i18n="template.title.config">Configurer le template</h6>
                            <div>
                                <button type="button" class="btn text-info" onclick="mv.templateGenerator.preview()">
                                    <i class="ri-eye-2-line"></i> <span i18n="studio.toolsbar.preview">Prévisualiser</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <span class="ddComponentsArea">
                        <div class="row" id="right-panel-generator">
                            <div class="col-md-6">
                                <div id="generatorComponents" class="card" style="height: 630px; padding: 10px;">
                                    <div id="cardAddComponent" class="card addComponent border-info text-info" onclick="mv.templateGenerator.componentSelector.load()" data-bs-toggle="modal" data-bs-target="#templageGeneratorSelector">
                                        <h6><i class="ri-add-line"></i></h6>
                                        <h6 i18n="template.add_component">Ajouter un composant</h6>
                                    </div>
                                    <hr/>
                                    <div class="generatorComponentsDDArea"><!-- insert components here --></div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div id="generatorPreview" class="card" style="height: 630px;"> 
                                    <div class="previewMess" id="generatorPreviewEmptyMsg">
                                        <h6><i class="ri-search-eye-line"></i></h6>
                                        <h6>Aperçu</h6>
                                    </div>
                                    <div id="generatorPreviewContent" class="p-3">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row d-none" id="bottom-panel-generator">
                            <div class="col-12 mb-2">
                                <div id="generatorComponents" class="card" style="height: 315px; padding: 10px;">
                                    <div id="cardAddComponent" class="card addComponent border-info text-info" onclick="mv.templateGenerator.componentSelector.load()" data-bs-toggle="modal" data-bs-target="#templageGeneratorSelector">
                                        <h6><i class="ri-add-line"></i></h6>
                                        <h6 i18n="template.add_component">Ajouter un composant</h6>
                                    </div>
                                    <hr/>
                                    <div class="generatorComponentsDDArea"><!-- insert components here --></div>
                                </div>
                            </div>
                            <div class="col-12">
                                <div id="generatorPreview" class="card col-12" style="height: 315px;"> 
                                    <div class="previewMess" id="generatorPreviewEmptyMsg">
                                        <h6><i class="ri-search-eye-line"></i></h6>
                                        <h6 i18n="preview">Aperçu</h6>
                                    </div>
                                    <div id="generatorPreviewContent" class="p-3">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </span>
                </div>
                <div class="modal-footer">                    
                    <button type="button" class="btn btn-primary" onclick="mv.templateGenerator.onValid()" data-bs-toggle="modal" data-bs-target="#mod-layerOptions" i18n="save">Enregistrer</button>
                    <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#mod-layerOptions" data-bs-dismiss="modal" i18n="close">Fermer</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="templageGeneratorSelector" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="templageGeneratorModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" i18n="template.generator">Générateur de template</h5>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body" id="modalTemplateGeneratorBody">
                </div>
                <div class="modal-footer">                    
                    <button type="button" id="templateSelectorAddBtn" onclick="mv.templateGenerator.componentSelector.onValid()" class="btn btn-primary d-none" data-bs-toggle="modal" data-bs-target="#templageGeneratorModal" onclick="" i18n="save">Enregistrer</button>
                    <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#templageGeneratorModal" i18n="close">Fermer</button>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
    
<script src="js/wizard.js"></script>
<script src="js/manageDisplayContainer.js"></script>
<script src="js/mviewerstudio.js"></script>
<script src="lib/icon-picker/icon-picker.js"></script>
<script src="lib/bootstrap-table/bootstrap-table.min.js"></script>
<script src="lib/bootstrap-table/bootstrap-table-fr-FR.min.js"></script>
<script src="lib/moment.js"></script>
<script src="lib/mustache-2.3.0/mustache.min.js"></script>
<script src="lib/icon-picker/icon-picker-new.js"></script>
<script type="module" src="lib/template-generator/main.js"></script>
</body>
</html>